<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"galaxyguan12.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.23.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="工厂方法简介工厂方法是一种创建型设计模式，它提供了在父类中创建对象的接口，但允许子类改变将要创建的对象的类型。工厂方法（Factory Method）的核心目标是解耦对象创建与使用逻辑。">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式之创建型模式">
<meta property="og:url" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/index.html">
<meta property="og:site_name" content="递归书房">
<meta property="og:description" content="工厂方法简介工厂方法是一种创建型设计模式，它提供了在父类中创建对象的接口，但允许子类改变将要创建的对象的类型。工厂方法（Factory Method）的核心目标是解耦对象创建与使用逻辑。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-1.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/screenshot-20250317-183315.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/screenshot-20250317-183010.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-10.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-8.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-12.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-11.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-9.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-4.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-6.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-7.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-2.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-3.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-5.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-13.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image-14.png">
<meta property="article:published_time" content="2024-01-29T14:46:56.000Z">
<meta property="article:modified_time" content="2025-06-29T23:59:12.780Z">
<meta property="article:author" content="GalaxyGuan">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/image.png">


<link rel="canonical" href="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/","path":"2024/01/29/architecture/design_pattern/design_pattern1/","title":"设计模式之创建型模式"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>设计模式之创建型模式 | 递归书房</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">递归书房</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">GalaxyGuan's Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95"><span class="nav-number">1.</span> <span class="nav-text">工厂方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF"><span class="nav-number">1.2.</span> <span class="nav-text">场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98"><span class="nav-number">1.3.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3"><span class="nav-number">1.4.</span> <span class="nav-text">解决</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B9%E6%9C%AC%E9%97%AE%E9%A2%98"><span class="nav-number">1.4.1.</span> <span class="nav-text">根本问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E7%B1%BB%E5%9B%BE"><span class="nav-number">1.4.2.</span> <span class="nav-text">完整类图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">1.4.3.</span> <span class="nav-text">代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E"><span class="nav-number">1.4.4.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8A%BF"><span class="nav-number">1.4.5.</span> <span class="nav-text">核心优势</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96"><span class="nav-number">1.4.6.</span> <span class="nav-text">代码优化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E9%85%8D%E7%BD%AE%E8%A1%A8"><span class="nav-number">1.4.6.0.1.</span> <span class="nav-text">静态配置表</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E7%AD%96%E7%95%A5"><span class="nav-number">1.4.6.0.2.</span> <span class="nav-text">动态策略</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82"><span class="nav-number">2.</span> <span class="nav-text">抽象工厂</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="nav-number">2.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF-1"><span class="nav-number">2.2.</span> <span class="nav-text">场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-1"><span class="nav-number">2.3.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-1"><span class="nav-number">2.4.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-1"><span class="nav-number">2.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85"><span class="nav-number">3.</span> <span class="nav-text">建造者</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-2"><span class="nav-number">3.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF-2"><span class="nav-number">3.2.</span> <span class="nav-text">场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E7%82%B9%E5%AF%B9%E7%85%A7%E8%A1%A81"><span class="nav-number">3.2.1.</span> <span class="nav-text">问题点对照表1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E7%82%B9%E5%AF%B9%E7%85%A7%E8%A1%A82"><span class="nav-number">3.2.2.</span> <span class="nav-text">问题点对照表2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-2"><span class="nav-number">3.3.</span> <span class="nav-text">解决</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%BC%8F%E8%A6%81%E7%B4%A0%E5%AF%B9%E7%85%A7%E8%A1%A8"><span class="nav-number">3.3.1.</span> <span class="nav-text">模式要素对照表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-2"><span class="nav-number">3.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.</span> <span class="nav-text">原型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-3"><span class="nav-number">4.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF-3"><span class="nav-number">4.2.</span> <span class="nav-text">场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-3"><span class="nav-number">4.3.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">4.4.</span> <span class="nav-text">示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E6%8A%BD%E8%B1%A1%E7%88%B6%E7%B1%BB%E5%AE%9A%E4%B9%89"><span class="nav-number">4.4.1.</span> <span class="nav-text">1. 基础抽象父类定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%9F%A9%E5%BD%A2%E5%AD%90%E7%B1%BB%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.4.2.</span> <span class="nav-text">2. 矩形子类实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%9C%86%E5%BD%A2%E5%AD%90%E7%B1%BB%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.4.3.</span> <span class="nav-text">3. 圆形子类实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">4.4.4.</span> <span class="nav-text">4. 客户端调用示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E7%B1%BB%E7%BB%93%E6%9E%84%E5%AF%B9%E6%AF%94%E8%A1%A8%E6%A0%BC"><span class="nav-number">4.4.5.</span> <span class="nav-text">5. 类结构对比表格</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-3"><span class="nav-number">4.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%95%E4%BE%8B"><span class="nav-number">5.</span> <span class="nav-text">单例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-4"><span class="nav-number">5.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-2"><span class="nav-number">5.2.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">5.3.</span> <span class="nav-text">解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="nav-number">5.4.</span> <span class="nav-text">示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E6%9E%84%E5%89%8D%EF%BC%9A"><span class="nav-number">5.4.1.</span> <span class="nav-text">重构前：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E6%9E%84%E5%90%8E%EF%BC%9A"><span class="nav-number">5.4.2.</span> <span class="nav-text">重构后：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9Avolatile-%E5%9C%A8%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E4%B8%AD%E7%9A%84%E5%8F%8C%E9%87%8D%E4%BD%9C%E7%94%A8"><span class="nav-number">5.4.3.</span> <span class="nav-text">拓展：volatile 在单例模式中的双重作用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%8F%AF%E8%A7%81%E6%80%A7%E4%BF%9D%E8%AF%81%EF%BC%88Visibility%EF%BC%89"><span class="nav-number">5.4.3.1.</span> <span class="nav-text">1. 可见性保证（Visibility）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E7%A6%81%E6%AD%A2%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92%E5%BA%8F%EF%BC%88Happens-Before%EF%BC%89"><span class="nav-number">5.4.3.2.</span> <span class="nav-text">2. 禁止指令重排序（Happens-Before）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-4"><span class="nav-number">5.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">6.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="GalaxyGuan"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">GalaxyGuan</p>
  <div class="site-description" itemprop="description">用递归追溯问题本质</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/gdr12?type=blog" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;gdr12?type&#x3D;blog" rel="noopener me" target="_blank"><i class="fa-solid fa-blog fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/GalaxyGuan12" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;GalaxyGuan12" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/dengrongguan12@gmail.com" title="E-Mail → dengrongguan12@gmail.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat.jpg" title="WeChat → &#x2F;images&#x2F;wechat.jpg" rel="noopener me"><i class="fab fa-weixin fa-fw"></i>WeChat</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/DarrenGuan" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;DarrenGuan" rel="noopener me" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://x.com/rerelaxguan" title="Twitter → https:&#x2F;&#x2F;x.com&#x2F;rerelaxguan" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="GalaxyGuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="递归书房">
      <meta itemprop="description" content="用递归追溯问题本质">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="设计模式之创建型模式 | 递归书房">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          设计模式之创建型模式
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-01-29 22:46:56" itemprop="dateCreated datePublished" datetime="2024-01-29T22:46:56+08:00">2024-01-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9E%B6%E6%9E%84/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="工厂方法"><a href="#工厂方法" class="headerlink" title="工厂方法"></a>工厂方法</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>工厂方法是一种创建型设计模式，它提供了在父类中创建对象的接口，但允许子类改变将要创建的对象的类型。工厂方法（Factory Method）的核心目标是<strong>解耦对象创建与使用逻辑。</strong></p>
<span id="more"></span>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>假设你正在创建一个物流管理应用程序。物流只采用卡车运输，所以当前只能处理卡车运输，大部分代码都位于 Truck 类中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 客户端运输管理类 */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogisticsManager</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transportCargo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 直接依赖具体类 Truck</span></span><br><span class="line">        <span class="type">Truck</span> <span class="variable">truck</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Truck</span>();</span><br><span class="line">        truck.deliver();</span><br><span class="line">        <span class="comment">// 新增其他运输类型需要继续扩展条件分支</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 卡车类（硬编码具体实现） */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Truck</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deliver</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;陆地运输：卡车配送&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>一段时间后，你想把海运物流也加到应用中。</p>
<p>这个时候你会发现，你可能需要再创建一个Ship类用于处理海运的请求，并且还需要修改主流程代码。你可能会做出如下修改：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 客户端运输管理类 */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogisticsManager</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transportCargo</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="comment">// 直接依赖具体类 Truck</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;land&quot;</span>.equals(type)) &#123;</span><br><span class="line">            <span class="type">Truck</span> <span class="variable">truck</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Truck</span>();</span><br><span class="line">            truck.deliver();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;sea&quot;</span>.equals(type)) &#123;</span><br><span class="line">            <span class="type">Ship</span> <span class="variable">ship</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ship</span>(); <span class="comment">// 新增 Ship 需修改此处</span></span><br><span class="line">            ship.deliver();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 新增其他运输类型需要继续扩展条件分支</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 卡车类（硬编码具体实现） */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Truck</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deliver</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;陆地运输：卡车配送&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 新增船舶类时被迫修改既有代码 */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ship</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deliver</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;海运：船舶配送&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li><strong>直接依赖具体实现</strong></li>
</ol>
<p><code>LogisticsManager</code> 直接通过 <code>new Truck()</code> 硬编码创建对象，客户端代码与 <code>Truck</code> 类强耦合。新增 <code>Ship</code> 类时必须修改 <code>transportCargo</code> 方法的逻辑。</p>
<ol start="2">
<li><strong>违反开闭原则</strong></li>
</ol>
<p>每添加一种新的运输工具（例如 <code>Ship</code> 或 <code>Airplane</code>），都需要：</p>
<ol start="3">
<li><strong>条件分支泛滥</strong></li>
</ol>
<p><code>if-else</code> 或 <code>switch</code> 语句扩散到多个位置（例如支付方式、日志记录等其他模块重复出现类似代码），维护成本指数级增长。</p>
<ol start="4">
<li><strong>代码重复风险</strong></li>
</ol>
<p>若其他模块（如计费系统）也需要根据运输类型创建对象，必须重复编写相同的条件分支逻辑，系统复杂度失控。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><h3 id="根本问题"><a href="#根本问题" class="headerlink" title="根本问题"></a><strong>根本问题</strong></h3><p>对象创建逻辑与业务逻辑深度耦合，未遵循「面向接口编程」原则 。工厂方法模式通过把创建过程封装到独立层级（如新增 <code>LandLogistics</code> &#x2F; <code>SeaLogistics</code> 子类）可彻底解决这些问题。</p>
<p>我们用工厂方法代替直接调用对象构造函数（也就是使用new）。但是对象还是通过new创建，只是new变成了在工厂方法里调用。工厂方法返回的对象就是“产品”。</p>
<p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image.png"></p>
<p>子类可以修改工厂方法返回的对象类型。</p>
<p>粗略看着这种更改可能没啥意义，我们只是改变了程序中调用构造函数的位置而已。但是，仔细想一下，现在你可以在子类中重写工厂方法，从而改变它创建产品的类型。</p>
<p>但有一点需要注意:只有这些产品具有共同的基类或者接口时，子类才能返回不同类型的产品，同时基类中工厂方法的返回类型也要声明成这个共有接口。</p>
<p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-1.png"></p>
<p>所有产品都必须使用同一接口。</p>
<p>举例来说，卡车Truck和轮船Ship类都必须实现运输Trans­port接口，这个接口声明了一个deliver方法。每个类都会以不同的方式实现这个方法：卡车走陆路交付货物，轮船走海路交付货物。陆路运输Road­Logis­tics类里的工厂方法返回卡车对象，而海路运输Sea­Logis­tics类就返回轮船对象。</p>
<h3 id="完整类图"><a href="#完整类图" class="headerlink" title="完整类图"></a>完整类图</h3><p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/screenshot-20250317-183315.png"></p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象产品接口：所有运输工具必须实现此接口 [^6]</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Transport</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deliver</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品实现：卡车类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Truck</span> <span class="keyword">implements</span> <span class="title class_">Transport</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deliver</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;陆地运输：卡车配送&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品实现：船舶类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ship</span> <span class="keyword">implements</span> <span class="title class_">Transport</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deliver</span><span class="params">()</span> &#123; </span><br><span class="line">        System.out.println(<span class="string">&quot;海运：船舶配送&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象工厂类（核心工厂方法) [^6]</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Logistics</span> &#123;</span><br><span class="line">    <span class="comment">// 模板方法：组合核心逻辑与工厂方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">planDelivery</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Transport</span> <span class="variable">transport</span> <span class="operator">=</span> createTransport();</span><br><span class="line">        transport.deliver();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工厂方法声明：延迟具体运输工具创建到子类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Transport <span class="title function_">createTransport</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂类：陆地物流 [^6]</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RoadLogistics</span> <span class="keyword">extends</span> <span class="title class_">Logistics</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Transport <span class="title function_">createTransport</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Truck</span>(); <span class="comment">// 无需判读条件的直接构造</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂类：海洋物流</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SeaLogistics</span> <span class="keyword">extends</span> <span class="title class_">Logistics</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Transport <span class="title function_">createTransport</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Ship</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端调用示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clientMethod</span><span class="params">(String logisticsType)</span> &#123;</span><br><span class="line">        Logistics logistics;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 通过简单映射选择具体工厂</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;road&quot;</span>.equals(logisticsType)) &#123;</span><br><span class="line">            logistics = <span class="keyword">new</span> <span class="title class_">RoadLogistics</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logistics = <span class="keyword">new</span> <span class="title class_">SeaLogistics</span>(); </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 统一调用接口（核心业务逻辑无需修改）</span></span><br><span class="line">        logistics.planDelivery();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ol>
<li><p><strong>实现关系</strong>：<code>Truck</code>&#x2F;<code>Ship</code> 实现 <code>Transport</code> 接口</p>
</li>
<li><p><strong>继承关系</strong>：<code>RoadLogistics</code>&#x2F;<code>SeaLogistics</code> 继承 <code>Logistics</code> 抽象类</p>
</li>
</ol>
<ol start="3">
<li><strong>依赖关系</strong>：<code>Logistics</code> 依赖 <code>Transport</code> 接口（虚线箭头）</li>
</ol>
<h3 id="核心优势"><a href="#核心优势" class="headerlink" title="核心优势"></a>核心优势</h3><ol>
<li><p><strong>快速扩展能力</strong>：新增空运只需添加 <code>AirLogistics</code> 类和 <code>Plane</code> 产品类，零&#x2F;少修改现有代码</p>
</li>
<li><p><strong>核心业务稳定</strong>：<code>planDelivery()</code> 模板方法与运输工具实现完全解耦&#x20;</p>
</li>
<li><p><strong>统一接口调用</strong>：客户端通过 <code>Logistics</code> 基类操作所有物流类型，符合里氏替换原则(在使用继承的过程中，子类可以完全替换掉父类，并且软件的功能不受到影响。这个原则是保证代码的健壮性和可扩展性的重要原则之一)</p>
</li>
</ol>
<h3 id="代码优化"><a href="#代码优化" class="headerlink" title="代码优化"></a>代码优化</h3><p>以上代码在客户端中还是存在条件判断分支，可以通过静态配置注册表或者动态策略解决。如果新增运输工具，客户端就只需要修改配置文件即可，真正实现零修改现有代码。</p>
<h5 id="静态配置表"><a href="#静态配置表" class="headerlink" title="静态配置表"></a>静态配置表</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建对象注册表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LogisticsRegistry</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Supplier&lt;Logistics&gt;&gt; registry = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        registry.put(<span class="string">&quot;road&quot;</span>, RoadLogistics::<span class="keyword">new</span>); <span class="comment">// 配置化绑定， 可以从配置文件中加载</span></span><br><span class="line">        registry.put(<span class="string">&quot;sea&quot;</span>, SeaLogistics::<span class="keyword">new</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Logistics <span class="title function_">getLogistics</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> registry.getOrDefault(type, SeaLogistics::<span class="keyword">new</span>).get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端无需任何条件判断</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clientMethod</span><span class="params">(String logisticsType)</span> &#123;</span><br><span class="line">        <span class="type">Logistics</span> <span class="variable">logistics</span> <span class="operator">=</span> LogisticsRegistry.getLogistics(logisticsType);</span><br><span class="line">        logistics.planDelivery();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="动态策略"><a href="#动态策略" class="headerlink" title="动态策略"></a>动态策略</h5><p>若系统存在动态运行时判定逻辑（如根据GPS坐标实时选择最优运输方式），则需在<strong>简单工厂层用策略模式</strong>处理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DynamicLogisticsSelector</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Logistics <span class="title function_">selectByConditions</span><span class="params">(Context ctx)</span> &#123;</span><br><span class="line">        <span class="comment">// 动态策略分支（仍可避免硬编码if）</span></span><br><span class="line">        <span class="keyword">return</span> strategyMap.get(ctx.analyze()).create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/screenshot-20250317-183010.png"></p>
<p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-10.png"></p>
<ol>
<li><p>产品（Prod­uct）接口。对于所有由创建者（Creator）以及它的子类构建的对象，这些接口都是通用的。</p>
</li>
<li><p>具体产品（Con­crete Prod­ucts）是产品接口的不同实现。</p>
</li>
<li><p>创建者（Cre­ator）声明了返回产品对象的工厂方法。方法的返回对象类型必须与产品接口一致。你可以把工厂方法声明为抽象方法，强制要求每个子类重新实现。或者，你也可以在基类工厂方法中返回默认产品类型。尽管它叫创建者，但它最主要的职责并不是创建产品（创建产品由具体创建者实现）。一般来说，创建者类包含一些与产品相关的核心业务逻辑。工厂方法把这些逻辑处理从具体产品类中分离出来？。</p>
</li>
<li><p>具体创建者（Con­crete Cre­ators）会重写基础的工厂方法，让他返回不同类型的产品。注意，并不一定每次调用工厂方法都会创建新的实例。工厂方法也可以返回缓存、对象池或其他来源的已有对象。</p>
</li>
</ol>
<h1 id="抽象工厂"><a href="#抽象工厂" class="headerlink" title="抽象工厂"></a>抽象工厂</h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><p>抽象工厂是一种创建型设计模式，可以生成相关对象系列，而无需指定它们的具体类。</p>
<h2 id="场景-1"><a href="#场景-1" class="headerlink" title="场景"></a>场景</h2><p>假设你正在写一个家具店模拟器。</p>
<p>你的代码这些类组成：</p>
<ol>
<li><p>相关产品系列，例如：椅子 + 沙发 + 咖啡桌。&#x20;</p>
</li>
<li><p>此系列有多种风格。例如，椅子 + 沙发 + 咖啡桌系列有以下风格：现代、维多利亚、装饰艺术。</p>
</li>
</ol>
<p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-8.png"></p>
<p>你需要一种方法来创建家具对象，确保它们与同一风格的其他对象相匹配。如果客户收到风格不匹配的家具，他们就会非常生气。</p>
<p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-12.png"></p>
<p>另外，在向程序添加新产品或产品系列时，你也不想更改现有代码。<del>家具供应商经常更新他们的家具种类，你也不想每次都更改核心代码。</del></p>
<p>按照惯例，大家一开始会怎么实现？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接实例化具体家具类导致风格混杂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createLivingRoom</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 混合使用不同风格组件（致命错误）</span></span><br><span class="line">        <span class="type">Chair</span> <span class="variable">modernChair</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModernChair</span>();</span><br><span class="line">        <span class="type">Sofa</span> <span class="variable">victorianSofa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VictorianSofa</span>();</span><br><span class="line">        <span class="type">CoffeeTable</span> <span class="variable">artDecoTable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArtDecoCoffeeTable</span>();</span><br><span class="line">        </span><br><span class="line">        modernChair.sit();</span><br><span class="line">        victorianSofa.lieDown();</span><br><span class="line">        artDecoTable.placeMagazine();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModernChair</span> <span class="keyword">extends</span> <span class="title class_">Chair</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sit</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;Modern chair sitting&quot;</span>); &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VictorianSofa</span> <span class="keyword">extends</span> <span class="title class_">Sofa</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lieDown</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;Victorian sofa relaxing&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArtDecoCoffeeTable</span> <span class="keyword">extends</span> <span class="title class_">CoffeeTable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">placeMagazine</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;ArtDeco table placement&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h2><ol>
<li><strong>风格一致性失控</strong></li>
</ol>
<p>客户端直接创建不同风格的对象（现代椅子+维多利亚沙发）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">╭── 问题场景 ──╮</span><br><span class="line">用户订单要求&quot;维多利亚风格客厅&quot;时：                    </span><br><span class="line">┌─────────────────┬──────────────────────┐</span><br><span class="line">│  预期组合       │ 实际可能创建的组合   │</span><br><span class="line">├─────────────────┼──────────────────────┤</span><br><span class="line">│ VictorianChair  │ VictorianChair       │</span><br><span class="line">│ VictorianSofa   │ ModernSofa ←不匹配   │</span><br><span class="line">│ VictorianTable  │ ArtDecoTable ←灾难性 │</span><br><span class="line">└─────────────────┴──────────────────────┘</span><br></pre></td></tr></table></figure>

<p><em>结果：客户收到风格冲突的家具套装</em></p>
<ol start="2">
<li><strong>对象创建硬编码</strong></li>
</ol>
<p>每当新增风格时（如新增ArtDeco），强制修改所有客户端代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增风格场景产生连锁修改</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="comment">// 必须添加新分支判断</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createSet</span><span class="params">(String style)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;ArtDeco&quot;</span>.equals(style)) &#123; <span class="comment">// 破坏开放封闭原则</span></span><br><span class="line">            chair = <span class="keyword">new</span> <span class="title class_">ArtDecoChair</span>(); <span class="comment">// 需要新增多个类引用</span></span><br><span class="line">            sofa = <span class="keyword">new</span> <span class="title class_">ArtDecoSofa</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>产品族管理失效</strong></li>
</ol>
<p>缺乏统一约束机制，易出现类型错误</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误将现代餐桌与维多利亚椅组合（类型系统无法阻止）</span></span><br><span class="line"><span class="type">FurnitureSet</span> <span class="variable">set</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FurnitureSet</span>(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ModernChair</span>(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">VictorianDiningTable</span>() <span class="comment">// 应该抛出异常但现有代码无法约束</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h2><p>抽象工厂模式建议的第一件事就是明确声明产品系列中每个不同产品的接口（例如，椅子、沙发或咖啡桌）。然后，让所有风格的产品都实现这些接口。例如，所有风格的椅子都可以实现 Chair 接口；所有风格的咖啡桌都可以实现 CoffeeTable 接口，等等。</p>
<p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-11.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口约束产品规格</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Chair</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sit</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Sofa</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lieDown</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CoffeeTable</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">placeItem</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 确保现代系列组件统一</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModernChair</span> <span class="keyword">implements</span> <span class="title class_">Chair</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sit</span><span class="params">()</span> &#123; </span><br><span class="line">        System.out.println(<span class="string">&quot;Modern chair designed seating&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModernSofa</span> <span class="keyword">implements</span> <span class="title class_">Sofa</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lieDown</span><span class="params">()</span> &#123; </span><br><span class="line">        System.out.println(<span class="string">&quot;Modern sofa clean lines design&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModernCoffeeTable</span> <span class="keyword">implements</span> <span class="title class_">CoffeeTable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">placeItem</span><span class="params">()</span> &#123; </span><br><span class="line">        System.out.println(<span class="string">&quot;Modern geometric table surfaces&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保证维多利亚风格一致性</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VictorianChair</span> <span class="keyword">implements</span> <span class="title class_">Chair</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sit</span><span class="params">()</span> &#123; </span><br><span class="line">        System.out.println(<span class="string">&quot;Classic carved wood chair&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VictorianSofa</span> <span class="keyword">implements</span> <span class="title class_">Sofa</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lieDown</span><span class="params">()</span> &#123; </span><br><span class="line">        System.out.println(<span class="string">&quot;Antique fabric sofa&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VictorianCoffeeTable</span> <span class="keyword">implements</span> <span class="title class_">CoffeeTable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">placeItem</span><span class="params">()</span> &#123; </span><br><span class="line">        System.out.println(<span class="string">&quot;Ornate marble-top table&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>下一步是声明抽象工厂（接口），其中包含特定产品系列所有产品的创建方法列表（例如，createChair、createSofa 和 createCoffeeTable）。这些方法必须返回我们之前定义的抽象产品类型接口：Chair、Sofa、CoffeeTable 等等。对于产品的每种风格，我们基于 AbstractFactory 接口创建一个单独的工厂类。这个工厂类是返回特定类型产品的类。例如，ModernFurnitureFactory 只能创建 ModernChair、ModernSofa 和 ModernCoffeeTable 对象。</p>
<p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-9.png"></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FurnitureFactory</span> &#123;</span><br><span class="line">    <span class="title class_">Chair</span> <span class="title function_">createChair</span>();</span><br><span class="line">    <span class="title class_">Sofa</span> <span class="title function_">createSofa</span>();</span><br><span class="line">    <span class="title class_">CoffeeTable</span> <span class="title function_">createCoffeeTable</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现代风格产品线工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ModernFactory</span> <span class="keyword">implements</span> <span class="title class_">FurnitureFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Chair</span> <span class="title function_">createChair</span>(<span class="params"></span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModernChair</span>(); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Sofa</span> <span class="title function_">createSofa</span>(<span class="params"></span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModernSofa</span>(); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">CoffeeTable</span> <span class="title function_">createCoffeeTable</span>(<span class="params"></span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModernCoffeeTable</span>(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 维多利亚风格产品线工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VictorianFactory</span> <span class="keyword">implements</span> <span class="title class_">FurnitureFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Chair</span> <span class="title function_">createChair</span>(<span class="params"></span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">VictorianChair</span>(); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Sofa</span> <span class="title function_">createSofa</span>(<span class="params"></span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">VictorianSofa</span>(); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">CoffeeTable</span> <span class="title function_">createCoffeeTable</span>(<span class="params"></span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">VictorianCoffeeTable</span>(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>客户端代码必须通过抽象接口来和工厂、产品协作。这样就可以更改传给客户端代码的工厂的类型以及客户端代码接收的产品风格，而不破坏实际的客户端代码。</p>
<p>假设客户希望工厂生产一把椅子。客户不必知道工厂的类别，也不必关心它得到的椅子是什么类型。无论是现代风格还是维多利亚风格的椅子，客户都必须使用抽象<code>Chair</code>接口以相同的方式处理所有椅子。唯一知道的是<code>sitOn</code>方法。此外，无论返回哪种椅子，它总是与同一工厂对象生产的沙发或咖啡桌风格相匹配。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FurnitureStore</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> FurnitureFactory factory;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 动态绑定具体工厂</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FurnitureStore</span><span class="params">(FurnitureFactory factory)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.factory = factory;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showcaseSet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Chair</span> <span class="variable">chair</span> <span class="operator">=</span> factory.createChair();</span><br><span class="line">        <span class="type">Sofa</span> <span class="variable">sofa</span> <span class="operator">=</span> factory.createSofa();</span><br><span class="line">        <span class="type">CoffeeTable</span> <span class="variable">table</span> <span class="operator">=</span> factory.createCoffeeTable();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;展示完整风格套件:&quot;</span>);</span><br><span class="line">        chair.sit();</span><br><span class="line">        sofa.lieDown();</span><br><span class="line">        table.placeItem();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建现代风格商店</span></span><br><span class="line">        <span class="type">FurnitureStore</span> <span class="variable">modernStore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FurnitureStore</span>(<span class="keyword">new</span> <span class="title class_">ModernFactory</span>());</span><br><span class="line">        modernStore.showcaseSet();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建维多利亚风格商店</span></span><br><span class="line">        <span class="type">FurnitureStore</span> <span class="variable">victorianStore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FurnitureStore</span>(<span class="keyword">new</span> <span class="title class_">VictorianFactory</span>());</span><br><span class="line">        victorianStore.showcaseSet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>还有一件事需要明确：如果客户端只接触抽象接口，那是什么创建了实际的工厂对象（即new ModernFactory()）？通常，应用程序在初始化阶段创建一个具体的工厂对象。在这之前，应用程序必须根据配置或环境设置选择工厂类型。</p>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-4.png"></p>
<p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-6.png"></p>
<ol>
<li><p>抽象产品（Abstract Prod­uct）：构成所有产品的一组接口。</p>
</li>
<li><p>具体产品（Con­crete Prod­uct）：抽象产品的多种不同类型实现。所有风格产品（维多利亚&#x2F;现代）都必须实现相应的抽象产品（椅子&#x2F;沙发）。</p>
</li>
<li><p>抽象工厂（Abstract Fac­to­ry）接口：声明了一组创建各种抽象产品的方法。</p>
</li>
<li><p>具体工厂（Con­crete Fac­to­ry）：实现抽象工厂的产品创建方法。每个具体工厂都对应特定风格的产品，且只能创建这一种风格的产品。</p>
</li>
<li><p>尽管具体工厂会对具体产品进行初始化，它的创建方法必须返回相应的抽象产品。只有这样，使用工厂类的客户端代码就不会与工厂创建的特定风格产品耦合。客户端（Client）只需通过抽象接口调用工厂和产品对象，就可以跟任何具体工厂&#x2F;产品进行交互。</p>
</li>
</ol>
<h1 id="建造者"><a href="#建造者" class="headerlink" title="建造者"></a>建造者</h1><h2 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h2><p><strong>Builder</strong>是一种创建型设计模式，可让你逐步构建复杂对象。这个模式允许你使用相同的构造代码生成对象的不同类型和表示形式？怎么理解？。</p>
<h2 id="场景-2"><a href="#场景-2" class="headerlink" title="场景"></a>场景</h2><p>假设一个复杂的对象，它需要逐步初始化许多字段和嵌套对象。通常它的初始化代码会放在带有大量参数的构造函数中，甚至可能散布在整个客户端代码中。</p>
<p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-7.png"></p>
<p>如上图，假设你需要创建一个House对象。对于一栋简单的房子，你只需要建造四面墙和一层地板，安装一扇门，安装一对窗户，并建造屋顶。但是，如果你想要一栋更豪华的房子，有后院和其他设施（如供暖系统、管道和电线），怎么办？</p>
<p>最简单的解决方案是扩展基<code>House</code>类并创建一组子类来覆盖所有参数组合。这样将得到相当多的子类。任何新参数（例如门廊样式）都需要进一步扩大类层次结构。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">House</span> &#123;</span><br><span class="line">    <span class="comment">// 基础参数</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> wallCount;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> hasDoor;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 扩展参数（部分子类不使用）</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> hasSwimmingPool; </span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> hasGarage;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> hasGarden;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分层构造函数（引发参数冗余）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">House</span><span class="params">(<span class="type">int</span> wallCount, <span class="type">boolean</span> hasDoor)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.wallCount = wallCount;</span><br><span class="line">        <span class="built_in">this</span>.hasDoor = hasDoor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 参数爆炸式重载（违反单一职责原则）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">House</span><span class="params">(<span class="type">int</span> wallCount, <span class="type">boolean</span> hasDoor, <span class="type">boolean</span> hasSwimmingPool)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(wallCount, hasDoor);</span><br><span class="line">        <span class="built_in">this</span>.hasSwimmingPool = hasSwimmingPool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">House</span><span class="params">(<span class="type">int</span> wallCount, <span class="type">boolean</span> hasDoor, </span></span><br><span class="line"><span class="params">                <span class="type">boolean</span> hasSwimmingPool, <span class="type">boolean</span> hasGarage)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(wallCount, hasDoor, hasSwimmingPool);</span><br><span class="line">        <span class="built_in">this</span>.hasGarage = hasGarage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更多构造函数组合...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基础房屋（必须调用父类构造传递无效参数）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BasicHouse</span> <span class="keyword">extends</span> <span class="title class_">House</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BasicHouse</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="number">4</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>); <span class="comment">// 强制填写无用参数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带泳池房屋</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HouseWithSwimmingPool</span> <span class="keyword">extends</span> <span class="title class_">House</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HouseWithSwimmingPool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="number">4</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带车库房屋</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HouseWithGarage</span> <span class="keyword">extends</span> <span class="title class_">House</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HouseWithGarage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="number">4</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 混合组合场景需创建新子类（类数量激增）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LuxuryHouse</span> <span class="keyword">extends</span> <span class="title class_">House</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LuxuryHouse</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="number">6</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>); <span class="comment">// 需要修改父类构造函数签名</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 类型强制转换问题</span></span><br><span class="line">        <span class="type">House</span> <span class="variable">basic</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicHouse</span>(); </span><br><span class="line">        <span class="type">House</span> <span class="variable">luxury</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LuxuryHouse</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 新增类型无法动态组合（需预定义所有子类）</span></span><br><span class="line">        <span class="keyword">if</span>(needHeatedPool) &#123;</span><br><span class="line">            <span class="comment">// 必须创建新的HeatedPoolHouse子类</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="问题点对照表1"><a href="#问题点对照表1" class="headerlink" title="问题点对照表1"></a>问题点对照表1</h3><table>
<thead>
<tr>
<th>设计缺陷</th>
<th>代码体现位置</th>
<th>后果分析</th>
</tr>
</thead>
<tbody><tr>
<td><strong>构造函数爆炸</strong></td>
<td>House类的多层构造重载</td>
<td>维护参数逻辑成本递增</td>
</tr>
<tr>
<td><strong>无效参数污染</strong></td>
<td>子类调用父类构造传默认值</td>
<td>内存浪费和逻辑隐患</td>
</tr>
<tr>
<td><strong>类数量指数增长</strong></td>
<td>LuxuryHouse等子类的机械式创建</td>
<td>系统复杂度失控</td>
</tr>
<tr>
<td><strong>动态组合能力缺失</strong></td>
<td>Client类中的条件分支</td>
<td>无法运行时灵活组合特性</td>
</tr>
</tbody></table>
<p>或者可以在基<code>House</code>类中创建一个巨大的构造函数，其中包含创建房屋对象的所有可能参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">House</span> &#123;</span><br><span class="line">    <span class="comment">// 核心参数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> wallCount;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> doorCount;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 可选设施</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> hasSwimmingPool; <span class="comment">// 90%场景无用参数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> hasSolarPanels;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> hasUndergroundBunker;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 装饰参数</span></span><br><span class="line">    <span class="keyword">private</span> String roofMaterial;</span><br><span class="line">    <span class="keyword">private</span> String wallPaintColor;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> hasLandscaping;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 电器系统 </span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> hasSmartHomeSystem;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> hasCentralAir;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 万能的构造函数（包含18个参数）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> wallCount 墙体数量（必须）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> doorCount 门数量（必须）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hasSwimmingPool 泳池存在性（90%为false）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> solarPanels 太阳能板（特殊设施）</span></span><br><span class="line"><span class="comment">     * ...其他参数省略...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">House</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="type">int</span> wallCount, </span></span><br><span class="line"><span class="params">        <span class="type">int</span> doorCount,</span></span><br><span class="line"><span class="params">        <span class="type">boolean</span> hasSwimmingPool,</span></span><br><span class="line"><span class="params">        <span class="type">boolean</span> hasSolarPanels,</span></span><br><span class="line"><span class="params">        <span class="type">boolean</span> hasUndergroundBunker,</span></span><br><span class="line"><span class="params">        String roofMaterial,</span></span><br><span class="line"><span class="params">        String wallPaintColor,</span></span><br><span class="line"><span class="params">        <span class="type">boolean</span> hasLandscaping,</span></span><br><span class="line"><span class="params">        <span class="type">boolean</span> hasSmartHomeSystem,</span></span><br><span class="line"><span class="params">        <span class="type">boolean</span> hasCentralAir</span></span><br><span class="line"><span class="params">        // ...还有<span class="number">8</span>个额外参数...</span></span><br><span class="line"><span class="params">    )</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.wallCount = wallCount;</span><br><span class="line">        <span class="built_in">this</span>.doorCount = doorCount;</span><br><span class="line">        <span class="built_in">this</span>.hasSwimmingPool = hasSwimmingPool; <span class="comment">// 参数浪费</span></span><br><span class="line">        <span class="built_in">this</span>.hasSolarPanels = hasSolarPanels;</span><br><span class="line">        <span class="comment">// ...剩余参数初始化逻辑...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端被迫填写无用参数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 基础住宅实例化（需要填写7个默认false）</span></span><br><span class="line">        <span class="type">House</span> <span class="variable">basicHouse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">House</span>(</span><br><span class="line">            <span class="number">4</span>, <span class="number">1</span>, </span><br><span class="line">            <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="comment">// 泳池/太阳能/地堡</span></span><br><span class="line">            <span class="string">&quot;Asphalt&quot;</span>, <span class="string">&quot;White&quot;</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span></span><br><span class="line">        );</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// 豪华住宅调用（所有参数必须显式指定）[^3]</span></span><br><span class="line">        <span class="type">House</span> <span class="variable">mansion</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">House</span>(</span><br><span class="line">            <span class="number">12</span>, <span class="number">6</span>, </span><br><span class="line">            <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;Slate&quot;</span>, <span class="string">&quot;Ivory&quot;</span>, <span class="literal">true</span>,</span><br><span class="line">            <span class="literal">true</span>, <span class="literal">true</span></span><br><span class="line">            <span class="comment">// ...仍需补全所有参数...</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="问题点对照表2"><a href="#问题点对照表2" class="headerlink" title="问题点对照表2"></a>问题点对照表2</h3><table>
<thead>
<tr>
<th>缺陷类型</th>
<th>代码表现示例</th>
<th>后果说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>参数雪崩</strong></td>
<td>构造函数包含18+参数</td>
<td>调用时参数序列难以理解</td>
</tr>
<tr>
<td><strong>强制默认值污染</strong></td>
<td>建造基础房屋必须传false参数</td>
<td>客户端代码臃肿易错</td>
</tr>
<tr>
<td><strong>扩展性灾难</strong></td>
<td>新增地下室参数需修改所有调用点</td>
<td>违背开闭原则（它指出一个软件实体（类、模块、函数等）应该对扩展开放，对修改关闭。也就是说，当需要添加新功能时，应该通过扩展现有代码来实现，而不是修改原有代码。这样可以保证原有代码的稳定性和可靠性，同时也方便了后续的维护和扩展。）</td>
</tr>
</tbody></table>
<p>虽然这种方法消除了对子类的需求，但它也会带来另一个问题。看一下新增参数时的情况。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新增&quot;有无宠物屋&quot;参数将导致灾难</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">House</span><span class="params">(</span></span><br><span class="line"><span class="params">    //...原有<span class="number">18</span>个参数...</span></span><br><span class="line"><span class="params">    <span class="type">boolean</span> hasPetHouse // 新增参数需要修改所有构造调用</span></span><br><span class="line"><span class="params">)</span> &#123; <span class="comment">/*...*/</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 所有现有调用都需要相应调整（即使不需要宠物屋）</span></span><br><span class="line"><span class="type">House</span> <span class="variable">basic</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">House</span>(..., <span class="literal">false</span> <span class="comment">/* 被迫添加新参数默认值 */</span>);</span><br></pre></td></tr></table></figure>

<p>大多数参数一般都不会被使用，使&#x5F97;<strong><a target="_blank" rel="noopener" href="https://refactoring.guru/smells/long-parameter-list">构造函数调用非常</a>ugly</strong>。例如，只有一小部分房屋有游泳池，因此与游泳池相关的参数基本都是无用的。</p>
<h2 id="解决-2"><a href="#解决-2" class="headerlink" title="解决"></a>解决</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Product类代表复杂对象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">House</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> wallMaterial;</span><br><span class="line">    <span class="keyword">private</span> int doors;</span><br><span class="line">    <span class="keyword">private</span> int windows;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> roofType;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">boolean</span> hasSwimmingPool;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setWallMaterial</span>(<span class="params"><span class="title class_">String</span> material</span>) &#123; <span class="comment">/*...*/</span> &#125;    <span class="comment">// 墙体材料设置[^4]</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setDoors</span>(<span class="params">int count</span>) &#123; <span class="comment">/*...*/</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setWindows</span>(<span class="params">int count</span>) &#123; <span class="comment">/*...*/</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setRoofType</span>(<span class="params"><span class="title class_">String</span> <span class="keyword">type</span></span>) &#123; <span class="comment">/*...*/</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setSwimmingPool</span>(<span class="params"><span class="built_in">boolean</span> has</span>) &#123; <span class="comment">/*...*/</span> &#125;        <span class="comment">// 可选游泳池配置[^6]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Builder接口定义建造步骤</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">HouseBuilder</span> &#123;</span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">reset</span>();</span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">buildWalls</span>();</span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">buildDoors</span>(int count);              <span class="comment">// 参数化建造方法[^4]</span></span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">buildWindows</span>(int count);</span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">buildRoof</span>(<span class="title class_">String</span> <span class="keyword">type</span>);</span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">buildSwimmingPool</span>();</span><br><span class="line">    <span class="title class_">House</span> <span class="title function_">getResult</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 石头房屋建造者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StoneHouseBuilder</span> <span class="keyword">implements</span> <span class="title class_">HouseBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">House</span> house = <span class="keyword">new</span> <span class="title class_">House</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">reset</span>(<span class="params"></span>) &#123; </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">house</span> = <span class="keyword">new</span> <span class="title class_">House</span>();            <span class="comment">// 重置构建状态[^4]</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">buildWalls</span>(<span class="params"></span>) &#123;               <span class="comment">// 实现具体建造逻辑</span></span><br><span class="line">        house.<span class="title function_">setWallMaterial</span>(<span class="string">&quot;花岗岩&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">buildRoof</span>(<span class="params"><span class="title class_">String</span> <span class="keyword">type</span></span>) &#123;     <span class="comment">// 参数化方法示例</span></span><br><span class="line">        house.<span class="title function_">setRoofType</span>(<span class="keyword">type</span> + <span class="string">&quot;石质屋顶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">buildSwimmingPool</span>(<span class="params"></span>) &#123;        <span class="comment">// 实现可选配置</span></span><br><span class="line">        house.<span class="title function_">setSwimmingPool</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 其他方法实现...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 木屋建造者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WoodHouseBuilder</span> <span class="keyword">implements</span> <span class="title class_">HouseBuilder</span> &#123; <span class="comment">/* 类似实现 */</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可扩展第三类建造者（例如现代玻璃房屋）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModernHouseBuilder</span> <span class="keyword">implements</span> <span class="title class_">HouseBuilder</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">buildWalls</span>(<span class="params"></span>) &#123;</span><br><span class="line">        currentHouse.<span class="title function_">setWallMaterial</span>(<span class="string">&quot;钢化玻璃&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">buildRoof</span>(<span class="params"><span class="title class_">String</span> <span class="keyword">type</span></span>) &#123;</span><br><span class="line">        currentHouse.<span class="title function_">setRoofType</span>(<span class="string">&quot;透明生态屋顶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Director控制建造流程</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConstructionDirector</span> &#123;                <span class="comment">// 封装常见建造方案[^1]</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">constructFamilyHouse</span>(<span class="params"><span class="title class_">HouseBuilder</span> builder</span>) &#123;</span><br><span class="line">        builder.<span class="title function_">reset</span>();</span><br><span class="line">        builder.<span class="title function_">buildWalls</span>();</span><br><span class="line">        builder.<span class="title function_">buildDoors</span>(<span class="number">3</span>);               <span class="comment">// 标准流程步骤[^3]</span></span><br><span class="line">        builder.<span class="title function_">buildWindows</span>(<span class="number">6</span>);</span><br><span class="line">        builder.<span class="title function_">buildRoof</span>(<span class="string">&quot;斜顶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">constructLuxuryVilla</span>(<span class="params"><span class="title class_">HouseBuilder</span> builder</span>) &#123;</span><br><span class="line">        builder.<span class="title function_">reset</span>();</span><br><span class="line">        builder.<span class="title function_">buildWalls</span>();</span><br><span class="line">        builder.<span class="title function_">buildDoors</span>(<span class="number">5</span>);</span><br><span class="line">        builder.<span class="title function_">buildWindows</span>(<span class="number">10</span>);</span><br><span class="line">        builder.<span class="title function_">buildRoof</span>(<span class="string">&quot;平顶&quot;</span>);</span><br><span class="line">        builder.<span class="title function_">buildSwimmingPool</span>();         <span class="comment">// 添加可选设施[^6]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Client使用示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConstructionClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">main</span>(<span class="params"><span class="title class_">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="title class_">ConstructionDirector</span> director = <span class="keyword">new</span> <span class="title class_">ConstructionDirector</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 建造石头别墅       </span></span><br><span class="line">        <span class="title class_">HouseBuilder</span> stoneBuilder = <span class="keyword">new</span> <span class="title class_">StoneHouseBuilder</span>();</span><br><span class="line">        director.<span class="title function_">constructLuxuryVilla</span>(stoneBuilder);    <span class="comment">// 调用导演建造逻辑[^5]</span></span><br><span class="line">        <span class="title class_">House</span> stoneVilla = stoneBuilder.<span class="title function_">getResult</span>();    <span class="comment">// 获取产品[^2]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 建造木屋</span></span><br><span class="line">        <span class="title class_">HouseBuilder</span> woodBuilder = <span class="keyword">new</span> <span class="title class_">WoodHouseBuilder</span>();</span><br><span class="line">        woodBuilder.<span class="title function_">buildSwimmingPool</span>();                <span class="comment">// 客户端自定义步骤</span></span><br><span class="line">        director.<span class="title function_">constructFamilyHouse</span>(woodBuilder);     </span><br><span class="line">        <span class="title class_">House</span> woodHouse = woodBuilder.<span class="title function_">getResult</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="模式要素对照表"><a href="#模式要素对照表" class="headerlink" title="模式要素对照表"></a>模式要素对照表</h3><table>
<thead>
<tr>
<th>标准元素</th>
<th>实现代码位置</th>
</tr>
</thead>
<tbody><tr>
<td>Builder接口</td>
<td>HouseBuilder接口</td>
</tr>
<tr>
<td>具体建造类</td>
<td>StoneHouseBuilder&#x2F;WoodHouseBuilder</td>
</tr>
<tr>
<td>导演类</td>
<td>HouseDirector</td>
</tr>
<tr>
<td>分离建造步骤</td>
<td>buildWalls&#x2F;addSwimmingPool等方法</td>
</tr>
</tbody></table>
<h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-2.png"></p>
<ol>
<li><p>生成器（Builder）接口：声明 所有生成器中通用的产品构造步骤。</p>
</li>
<li><p>具体生成器（Con­crete Builders）：提供构造过程的不同实现。具体生成器也可以构造不遵循通用接口的产品。</p>
</li>
<li><p>产品（Prod­ucts）是最终生成的对象。由不同生成器构造的产品不需要属于同一类层次结构或接口。</p>
</li>
<li><p>（Direc­tor）类定义了构造步骤的调用顺序，这样你就可以复用特定的产品创建过程。</p>
</li>
<li><p>客户端（Client）必须把某个生成器与Director类关联。一般情况下，你只需通过Director类构造函数的参数进行一次性关联就可以了。之后Direct类就能使用Builder对象完成后续所有的构造任务。或者是在客户端使用Director类构建产品时每次都传入不同的生成器, 这也是我们代码中使用的方式。</p>
</li>
</ol>
<h1 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h1><h2 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h2><p><strong>原型</strong>是一种创建型设计模式，它允许你复制现有对象，而不需要依赖它们的类。</p>
<h2 id="场景-3"><a href="#场景-3" class="headerlink" title="场景"></a>场景</h2><p>假设你有一个对象，你想创建它的一个完美副本。你会怎么做？首先，你必须创建一个相同类的新对象。然后你必须遍历原始对象的所有字段，并把它的值复制到新对象。</p>
<p>但是有一个问题。某些对象的字段可能是私有的，从对象本身外部不可见。</p>
<p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-3.png"></p>
<p>直接复制还有一个问题。你必须知道对象的类才能创建副本，因此你的代码会依赖这个类。有时你只知道对象实现的接口，但不知道具体类。</p>
<h2 id="解决-3"><a href="#解决-3" class="headerlink" title="解决"></a>解决</h2><p>原型模式把克隆过程委托给要克隆的实际对象。它为所有要克隆的对象声明一个通用接口。此接口允许你克隆对象，但不需要把代码与对象的类耦合。通常，这样的接口只包含一个<code>clone</code>方法。</p>
<p><code>clone</code>的实现在所有类中类似。它创建当前类的一个对象，并且把旧对象的所有字段值转移到新对象里。你甚至可以复制私有字段，因为大多数编程语言都允许对象访问属于同一类的其他对象的私有字段。</p>
<p>支持克隆的对象称为<em>原型</em>。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-5.png"></p>
<h3 id="1-基础抽象父类定义"><a href="#1-基础抽象父类定义" class="headerlink" title="1. 基础抽象父类定义"></a>1. 基础抽象父类定义</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Shape</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> xCoord;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> yCoord;</span><br><span class="line">    <span class="keyword">protected</span> String fillColor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 基础构造方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Shape</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.xCoord = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">this</span>.yCoord = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">this</span>.fillColor = <span class="string">&quot;#FFFFFF&quot;</span>;  <span class="comment">// 默认填充颜色</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 原型构造方法（拷贝构造核心）</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">Shape</span><span class="params">(Shape prototype)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.xCoord = prototype.xCoord;         <span class="comment">// 坐标克隆</span></span><br><span class="line">        <span class="built_in">this</span>.yCoord = prototype.yCoord;         <span class="comment">// 实现位置复制</span></span><br><span class="line">        <span class="built_in">this</span>.fillColor = prototype.fillColor;   <span class="comment">// 颜色属性继承</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Shape <span class="title function_">clone</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-矩形子类实现"><a href="#2-矩形子类实现" class="headerlink" title="2. 矩形子类实现"></a>2. 矩形子类实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> width;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">(Rectangle source)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(source);             <span class="comment">// 调用父类拷贝构造</span></span><br><span class="line">        <span class="built_in">this</span>.width = source.width;       <span class="comment">// 特有属性复制</span></span><br><span class="line">        <span class="built_in">this</span>.height = source.height;     <span class="comment">// 包括宽高参数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Rectangle <span class="title function_">clone</span><span class="params">()</span> &#123;     <span class="comment">// 返回具体子类类型</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="built_in">this</span>);     <span class="comment">// 原型引导构造</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-圆形子类实现"><a href="#3-圆形子类实现" class="headerlink" title="3. 圆形子类实现"></a>3. 圆形子类实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> radius;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">(Circle source)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(source);           <span class="comment">// 父类属性初始化</span></span><br><span class="line">        <span class="built_in">this</span>.radius = source.radius;   <span class="comment">// 半径参数拷贝</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRadius</span><span class="params">(<span class="type">int</span> r)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.radius = r;          <span class="comment">// 半径独立可变</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Circle <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Circle</span>(<span class="built_in">this</span>);      <span class="comment">// 生成新实例</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-客户端调用示例"><a href="#4-客户端调用示例" class="headerlink" title="4. 客户端调用示例"></a>4. 客户端调用示例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Shape</span> <span class="variable">prototype</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">prototype.setPosition(<span class="number">15</span>, <span class="number">20</span>);</span><br><span class="line">prototype.setColor(<span class="string">&quot;#FFA500&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 快速生成克隆体</span></span><br><span class="line"><span class="type">Shape</span> <span class="variable">clonedCircle</span> <span class="operator">=</span> prototype.clone();  <span class="comment">// 无需知道具体类型</span></span><br><span class="line">clonedCircle.move(<span class="number">5</span>, <span class="number">5</span>);                 <span class="comment">// 获得独立坐标</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造矩形原型</span></span><br><span class="line"><span class="type">Shape</span> <span class="variable">rectProto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">rectProto.setSize(<span class="number">100</span>, <span class="number">200</span>);            <span class="comment">// 原始配置</span></span><br><span class="line"><span class="type">Shape</span> <span class="variable">clonedRect</span> <span class="operator">=</span> rectProto.clone();   <span class="comment">// 完美复制属性</span></span><br></pre></td></tr></table></figure>



<h3 id="5-类结构对比表格"><a href="#5-类结构对比表格" class="headerlink" title="5. 类结构对比表格"></a>5. 类结构对比表格</h3><table>
<thead>
<tr>
<th>功能特性</th>
<th>Shape父类规范</th>
<th>Rectangle实现</th>
<th>Circle实现</th>
</tr>
</thead>
<tbody><tr>
<td>坐标克隆</td>
<td>通过拷贝构造函数</td>
<td>自动继承父类实现</td>
<td>自动继承父类实现</td>
</tr>
<tr>
<td>特有属性拷贝</td>
<td>抽象方法约束</td>
<td>单独处理宽高</td>
<td>单独处理半径</td>
</tr>
<tr>
<td>方法返回类型</td>
<td>声明Shape抽象类型</td>
<td>返回具体Rectangle类型</td>
<td>返回具体Circle类型</td>
</tr>
<tr>
<td>内存效率优化</td>
<td>Cache机制（扩展功能）</td>
<td>支持预建原型池</td>
<td>支持颜色模板复用</td>
</tr>
</tbody></table>
<h2 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-13.png"></p>
<ol>
<li><p>原型（Pro­to­type）接口：声明Clone方法。在绝大多数情况下，里面只会有一个clone方法。</p>
</li>
<li><p>具体原型（Con­crete Pro­to­type）类：实现Clone方法。除了把原始对象的数据复制到新的克隆体中之外，这个方法有时还需处理克隆过程中的极端情况，例如克隆关联对象和递归依赖等等。</p>
</li>
<li><p>客户端（Client）可以复制实现了原型接口的任何对象。</p>
</li>
</ol>
<h1 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h1><h2 id="简介-4"><a href="#简介-4" class="headerlink" title="简介"></a>简介</h2><p><strong>单例</strong>是一种创建型设计模式，它可以确保一个类只有一个实例，同时为该实例提供全局访问点。</p>
<h2 id="问题-2"><a href="#问题-2" class="headerlink" title="问题"></a>问题</h2><p>单例模式同时解决了两个问题：</p>
<ol>
<li><p><strong>确保一个类只有一个实例</strong>。最常见的场景是控制对某些共享资源（例如数据库或文件）的访问。假设你已经创建了一个对象，又要创建一个相同类的对象。你不会得到一个新的对象，而是会得到你已经创建的对象。这种行为是无法通过常规构造函数实现，因为构造函数调用在设计上<strong>必须</strong>始终返回一个新对象。</p>
</li>
<li><p><strong>为该实例提供全局访问点</strong>。全局变量非常方便，但很不安全，因为任何代码都可能覆盖这些变量的内容并使程序崩溃。单例模式类似全局变量，允许你从程序中的任何位置访问某个对象。但是，它还可以保护这个实例不被其他代码覆盖。还有一点，为了不让实现问题1 的代码分散在各个地方，要把它限制在一个类中，特别是当你的其余代码已经依赖了它的时候。</p>
</li>
</ol>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>所有 Singleton 的实现都有这样两个共同的步骤：</p>
<ul>
<li><p>把默认构造函数设为私有，防止其他对象使用<code>new</code>创建它。</p>
</li>
<li><p>创建一个充当构造函数的静态创建方法。这个方法会调用私有构造函数来创建一个对象并把它缓存在静态字段中。这个方法的所有后续调用都会返回缓存好的对象。</p>
</li>
</ul>
<p>如果你的代码能访问 Singleton 类，那么它就可以调用 Singleton 的静态方法。无论何时调用该方法，都会返回相同的对象。</p>
<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><p>数据库连接</p>
<h3 id="重构前："><a href="#重构前：" class="headerlink" title="重构前："></a>重构前：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DBUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Connection <span class="title function_">getConn</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(URL); <span class="comment">// 每次新建连接消耗500ms+</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用端</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">DBUtil</span>().getConn().execute(<span class="string">&quot;SELECT...&quot;</span>); </span><br><span class="line"><span class="keyword">new</span> <span class="title class_">DBUtil</span>().getConn().execute(<span class="string">&quot;UPDATE...&quot;</span>); <span class="comment">// 产生两个独立连接</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="重构后："><a href="#重构后：" class="headerlink" title="重构后："></a>重构后：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Database</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Database instance; </span><br><span class="line">    <span class="keyword">private</span> Connection connection;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 私有化构造并建立物理连接</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Database</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.connection = DriverManager.getConnection(JDBC_URL); <span class="comment">// 真实连接建立</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 双重检查锁定实现线程安全</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Database <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123; </span><br><span class="line">            <span class="keyword">synchronized</span> (Database.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Database</span>(); </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 统一入口方法（可扩展缓存逻辑）</span></span><br><span class="line">    <span class="keyword">public</span> ResultSet <span class="title function_">query</span><span class="params">(String sql)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> connection.createStatement().executeQuery(sql); <span class="comment">// 所有SQL通过单连接执行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="拓展：volatile-在单例模式中的双重作用"><a href="#拓展：volatile-在单例模式中的双重作用" class="headerlink" title="拓展：volatile 在单例模式中的双重作用"></a>拓展：volatile 在单例模式中的双重作用</h3><h4 id="1-可见性保证（Visibility）"><a href="#1-可见性保证（Visibility）" class="headerlink" title="1. 可见性保证（Visibility）"></a>1. 可见性保证（Visibility）</h4><p>阻止线程的本地缓存与主内存数据不同步，确保所有线程读取到的是最新实例状态。</p>
<h4 id="2-禁止指令重排序（Happens-Before）"><a href="#2-禁止指令重排序（Happens-Before）" class="headerlink" title="2. 禁止指令重排序（Happens-Before）"></a>2. 禁止指令重排序（Happens-Before）</h4><p>消除 JVM 级别可能的危险优化（非原子化对象构造的三步指令）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">未加 volatile 时的风险时序：</span><br><span class="line">A线程: 分配内存 → 写入未初始化的对象引用（指令排序导致）</span><br><span class="line">B线程: 获取到非空引用 → 访问未完成初始化的对象（空指针异常）</span><br><span class="line"></span><br><span class="line">volatile 强制时序：</span><br><span class="line">分配内存 → 初始化对象 → 写入引用（三步骤原子性可见）</span><br></pre></td></tr></table></figure>



<h2 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/01/29/architecture/design_pattern/design_pattern1/image-14.png"></p>
<ol>
<li>单例（Sin­gle­ton）类：声明了一个叫做get­Instance获的静态方法来返回实例。单例的构造函数必须为私有。调用获取实例方法必须是获取单例对象的唯一方式。</li>
</ol>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/creational-patterns">https://refactoring.guru/design-patterns/creational-patterns</a></p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/arvi9/Dive-Into-Design-Patterns---Code-Samples">https://github.com/arvi9/Dive-Into-Design-Patterns---Code-Samples</a></p>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>GalaxyGuan
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/" title="设计模式之创建型模式">https://galaxyguan12.github.io/2024/01/29/architecture/design_pattern/design_pattern1/</a>
  </li>
  <li class="post-copyright-license">
      <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag"># 设计模式</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/03/29/record/timeout_debug/" rel="prev" title="记一次超时毛刺排查过程">
                  <i class="fa fa-angle-left"></i> 记一次超时毛刺排查过程
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/02/08/architecture/design_pattern/design_pattern2/" rel="next" title="设计模式之结构型模式">
                  设计模式之结构型模式 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">GalaxyGuan</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
