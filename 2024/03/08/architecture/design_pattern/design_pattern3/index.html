<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"galaxyguan12.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.23.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="责任链简介责任链是一种行为设计模式，允许你把请求沿着处理者链进行发送。收到请求后，每个处理者均可对请求进行处理，或将其传递给链上的下个处理者。">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式之行为型模式">
<meta property="og:url" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/index.html">
<meta property="og:site_name" content="递归书房">
<meta property="og:description" content="责任链简介责任链是一种行为设计模式，允许你把请求沿着处理者链进行发送。收到请求后，每个处理者均可对请求进行处理，或将其传递给链上的下个处理者。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-11.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-10.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-12.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-1.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-2.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-9.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-8.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-6.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-7.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-14.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-3.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-5.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-13.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-4.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-26.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-15.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-23.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-25.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-24.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-29.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-27.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-21.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-28.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-20.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-19.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-18.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-22.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-16.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-17.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-30.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-31.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-32.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-33.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-34.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-35.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-36.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-37.png">
<meta property="og:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/diagram.png">
<meta property="article:published_time" content="2024-03-08T14:46:56.000Z">
<meta property="article:modified_time" content="2025-06-29T23:59:12.837Z">
<meta property="article:author" content="GalaxyGuan">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/image-11.png">


<link rel="canonical" href="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/","path":"2024/03/08/architecture/design_pattern/design_pattern3/","title":"设计模式之行为型模式"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>设计模式之行为型模式 | 递归书房</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">递归书房</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">GalaxyGuan's Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE"><span class="nav-number">1.</span> <span class="nav-text">责任链</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98"><span class="nav-number">1.2.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3"><span class="nav-number">1.3.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4"><span class="nav-number">2.</span> <span class="nav-text">命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="nav-number">2.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-x20"><span class="nav-number">2.2.</span> <span class="nav-text">问题 </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-1"><span class="nav-number">2.3.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-1"><span class="nav-number">2.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">3.</span> <span class="nav-text">迭代器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-2"><span class="nav-number">3.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-1"><span class="nav-number">3.2.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-2"><span class="nav-number">3.3.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-2"><span class="nav-number">3.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85"><span class="nav-number">4.</span> <span class="nav-text">中介者</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-3"><span class="nav-number">4.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-2"><span class="nav-number">4.2.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-3"><span class="nav-number">4.3.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-3"><span class="nav-number">4.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95"><span class="nav-number">5.</span> <span class="nav-text">备忘录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-4"><span class="nav-number">5.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-3"><span class="nav-number">5.2.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-4"><span class="nav-number">5.3.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-4"><span class="nav-number">5.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85"><span class="nav-number">6.</span> <span class="nav-text">观察者</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-5"><span class="nav-number">6.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-4"><span class="nav-number">6.2.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-5"><span class="nav-number">6.3.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-5"><span class="nav-number">6.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8A%B6%E6%80%81"><span class="nav-number">7.</span> <span class="nav-text">状态</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-6"><span class="nav-number">7.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98-5"><span class="nav-number">7.2.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-6"><span class="nav-number">7.3.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-6"><span class="nav-number">7.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AD%96%E7%95%A5"><span class="nav-number">8.</span> <span class="nav-text">策略</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-7"><span class="nav-number">8.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF"><span class="nav-number">8.2.</span> <span class="nav-text">场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-7"><span class="nav-number">8.3.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-7"><span class="nav-number">8.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95"><span class="nav-number">9.</span> <span class="nav-text">模板方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-8"><span class="nav-number">9.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF-1"><span class="nav-number">9.2.</span> <span class="nav-text">场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-8"><span class="nav-number">9.3.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-8"><span class="nav-number">9.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85"><span class="nav-number">10.</span> <span class="nav-text">访问者</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-9"><span class="nav-number">10.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF-2"><span class="nav-number">10.2.</span> <span class="nav-text">场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3-9"><span class="nav-number">10.3.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-9"><span class="nav-number">10.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8"><span class="nav-number">11.</span> <span class="nav-text">解释器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-10"><span class="nav-number">11.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84"><span class="nav-number">11.2.</span> <span class="nav-text">结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">11.3.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">11.4.</span> <span class="nav-text">示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E7%82%B9"><span class="nav-number">11.5.</span> <span class="nav-text">优点</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="GalaxyGuan"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">GalaxyGuan</p>
  <div class="site-description" itemprop="description">用递归追溯问题本质</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/gdr12?type=blog" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;gdr12?type&#x3D;blog" rel="noopener me" target="_blank"><i class="fa-solid fa-blog fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/GalaxyGuan12" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;GalaxyGuan12" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/dengrongguan12@gmail.com" title="E-Mail → dengrongguan12@gmail.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat.jpg" title="WeChat → &#x2F;images&#x2F;wechat.jpg" rel="noopener me"><i class="fab fa-weixin fa-fw"></i>WeChat</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/DarrenGuan" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;DarrenGuan" rel="noopener me" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://x.com/rerelaxguan" title="Twitter → https:&#x2F;&#x2F;x.com&#x2F;rerelaxguan" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="GalaxyGuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="递归书房">
      <meta itemprop="description" content="用递归追溯问题本质">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="设计模式之行为型模式 | 递归书房">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          设计模式之行为型模式
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-08 22:46:56" itemprop="dateCreated datePublished" datetime="2024-03-08T22:46:56+08:00">2024-03-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9E%B6%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">架构</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9E%B6%E6%9E%84/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="责任链"><a href="#责任链" class="headerlink" title="责任链"></a>责任链</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>责任链是一种行为设计模式，允许你把请求沿着处理者链进行发送。收到请求后，每个处理者均可对请求进行处理，或将其传递给链上的下个处理者。</p>
<span id="more"></span>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假如你正在开发一个订单系统。 你希望限制系统访问，只允许认证用户创建订单。 而管理员拥有所有订单的完全访问权限。</p>
<p>按照一般的开发思路，你会依次执行这些检查。 只要接收到包含用户凭据的请求，系统就可以尝试认证。 如果认证失败， 那就没有必要再进行后续检查了。如下图。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-11.png"></p>
<p>“请求必须经过一系列检查后才能由订购系统来处理”</p>
<p>接着，关于认证检查的需求越来越多。比如为了不让原始数据直接传递到订单系统，需要在认证之后清理请求中的数据；比如为了对暴力密码破解或者爬虫请求进行限流，又需要在认证之后增加过滤来自同一 IP 地址的重复请求逻辑；比如为了提高系统响应速度，降低系统负载，又需要在请求发送给系统之前检查有没有缓存结果，如果没有才会把请求发送给系统。如下图，这部分逻辑就会越来越多，越来越混乱。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-10.png"></p>
<p>代码变得越来越多， 也越来越混乱。</p>
<p>检查代码就越来越复杂。 修改某个检查步骤可能也会影响其他的检查步骤。 而且当你希望复用这些检查步骤来保护其他系统时，你只能复制部分代码， 因为这些系统只需要部分检查步骤。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>与许多其他行为设计模式一样， 责任链会把 特定行为转换成 被称作处理者的独立对象。 在上面示例里， 每个检查步骤都可以被抽取成仅有单个方法的类， 并执行检查操作。 请求和对应数据会被作为参数传递给这个方法。</p>
<p>这个模式建议你把这些处理者连成一条链。 链上的每个处理者都有一个成员变量来保存对于下一个处理者的引用。 除了处理请求外， 处理者还负责沿着链传递请求。 请求会在链上移动， 直到所有处理者都有机会对他进行处理。</p>
<p>最重要的是： 处理者可以决定不再沿着链传递请求， 这就可以高效地取消所有后面的处理步骤。</p>
<p>在我们的订购系统示例中， 处理者会在进行请求处理工作后决定要不要继续沿着链传递请求。 如果请求中包含正确的数据， 所有处理者都会执行自己的主要行为， 无论这个行为是身份验证还是数据缓存。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-12.png"></p>
<p>处理者依次排列， 组成一条链。</p>
<p>不过还有一种稍微不同的方式 （也是更经典一种）， 那就是处理者接收到请求后自己决定是否能够对其进行处理。 如果自己能够处理， 处理者就不再继续传递请求。 因此在这种情况下， 每个请求要么最多有一个处理者进行处理， 要么没有任何处理者进行处理。 在处理图形用户界面元素栈中的事件时， 这种方式非常常见。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Handler接口定义处理契约</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Request request)</span> <span class="keyword">throws</span> AuthException; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BaseHandler实现链式传递逻辑</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseHandler</span> <span class="keyword">implements</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Handler next;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> BaseHandler <span class="title function_">setNext</span><span class="params">(Handler next)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.next = next;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">passToNext</span><span class="params">(Request request)</span> <span class="keyword">throws</span> AuthException &#123;</span><br><span class="line">        <span class="keyword">if</span> (next != <span class="literal">null</span>) next.handle(request);  <span class="comment">// 核心链式调用逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者1：用户认证</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserAuthHandler</span> <span class="keyword">extends</span> <span class="title class_">BaseHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Request request)</span> <span class="keyword">throws</span> AuthException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!validateUser(request.getUserId())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AuthException</span>(<span class="string">&quot;用户未登录&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        passToNext(request);  <span class="comment">// 验证成功移交后续处理</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者2：权限校验 </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PermissionHandler</span> <span class="keyword">extends</span> <span class="title class_">BaseHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Request request)</span> <span class="keyword">throws</span> AuthException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!checkAdminPermission(request.getUserId())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PermissionException</span>(<span class="string">&quot;权限不足&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        passToNext(request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Client动态组合处理链</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Handler chain;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chain = <span class="keyword">new</span> <span class="title class_">UserAuthHandler</span>()</span><br><span class="line">            .setNext(<span class="keyword">new</span> <span class="title class_">PermissionHandler</span>());  <span class="comment">// 灵活配置处理顺序</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">        chain.handle(request);  <span class="comment">// 统一入口触发处理链</span></span><br><span class="line">        <span class="comment">// 执行业务逻辑...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>核心改进点：</p>
<ol>
<li><p><strong>解耦检查逻辑</strong>：每个安全检查独立成类，通过setNext组合链式结构</p>
</li>
<li><p><strong>动态扩展性</strong>：新增日志检查仅需创建LogHandler并插入链中任意位置</p>
</li>
<li><p><strong>复用性增强</strong>：在PaymentService中可重用UserAuthHandler而不需要重复验证代码</p>
</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image.png"></p>
<ol>
<li><p>(Handler)声明了所有具体处理者的通用接口。这个接口通 常只包含单个方法用于请求处理，但有时它还会包含一个设置链上 下一个处理者的方法。&#x20;</p>
</li>
<li><p>(Base Handler)是一个可选的类，你可以把所有处理者共用的样本代码放在里面。 通常情况下，这个类里定义了一个保存下个处理者引用的成员变量。客户端可以把下个处理者传递给上个处理者的构造函数或用setter方法 来创建链。这个类还可以实现默认的处理行为: 比如确定下个处理者存在后再把请求传递给它。&#x20;</p>
</li>
<li><p>(Concrete Handlers)包含处理请求的实际代码。每 个处理者接收到请求后，都必须决定要不要处理，以及要不要沿 着链传递请求。 处理者通常是独立并且不可变的，需要通过构造函数一次性地获得 所有必要的数据。&#x20;</p>
</li>
<li><p>(Client) 可根据程序逻辑一次性或者动态地生成链。 需要注意一下，请求可以发送给链上的任意一个处理者，不一定是第一个处理者。&#x20;</p>
</li>
</ol>
<h1 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><p>命令是一种行为设计模式， 它能把请求转换为一个包含与请求相关的所有信息 的独立对象。这个转换能让你把请求方法参数化、延迟请求执行或把请求放在队列里，并且能实现可撤销操作。&#x20;</p>
<h2 id="问题-x20"><a href="#问题-x20" class="headerlink" title="问题&#x20;"></a>问题&#x20;</h2><p>假如你正在开发一款文字编辑器，当前的任务是创建一个包含多个按钮的工具栏，并让每个按钮对应编辑器的不同操作。你创建了一 个非常简洁的 按钮 类，它不仅可用于创建工具栏上的按钮对象，还可用 于创建各种对话框中的按钮对象。&#x20;</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-1.png"></p>
<p>应用中的所有按钮都可以继承相同的类</p>
<p>尽管所有按钮看上去都很相似，但它们可以完成不同的操作(打开 保存、打印和应用等)。这时你会把这些按钮的点击处理代码放在哪里呢？最简单的解决方案是在使用按钮的每个地方都创建大量的子类。这些 子类中包含按钮点击后必须执行的代码。&#x20;</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-2.png"></p>
<p>大量的按钮子类&#x20;</p>
<p>因为复制&#x2F;粘贴文字等操作可能会在多个地方被调 用。比如用戶可以点击工具栏上的“复制”按钮，或者可以通过上下文菜单复制内容，也可以直接使用键盘上的 Ctrl+C 。</p>
<p>我们的程序最初只有工具栏，因此可以使用按钮子类来实现各种不同 操作。换句话说， 复制按钮 CopyButton 子类包含复制文字处理的代码是可行的。但是如果想使用上下文菜单或者快捷方式进行复制，你要么是把复制处理代码copy到多个类里，要么是让菜单依赖于CopyButton按钮，显然这两个都不好。</p>
<h2 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h2><p>优秀的软件设计通常会把关注点分离，即对软件进行分层。比如GUI应用，GUI层负责渲染用戶图像界面并和用户交互，业务逻辑层负责处理业务逻辑。 GUI 层会捕获所有输入并把工作委派给业务逻辑层。&#x20;</p>
<p>这在代码中看上去就像这样:一个 GUI 对象传递一些参数来调用一个 业务逻辑对象。也可以说是发送请求，如下图，不同的GUI操作对应相同的操作。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-9.png"></p>
<p>GUI 层可以直接访问业务逻辑层&#x20;</p>
<p>而命令模式建议 GUI 对象不直接提交这些请求。而是把请求的所有细节(比如调用的对象、方法名称和参数列表)抽取出来组成命令类，在类里只包含一个用于触发请求的方法。&#x20;</p>
<p>命令对象负责连接不同的 GUI 和业务逻辑对象。这样，GUI 对象就不需要了解业务逻辑对象有没有获得请求，也没必要了解它是怎么处理请求的。GUI 对象触发命令就可以了。命令对象会自行处理所有细节工作。如下图，相同的操作被抽取成命令对象，命令对象将GUI层和业务逻辑层联系起来。&#x20;</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-8.png"></p>
<p>通过命令访问业务逻辑层</p>
<p>下一步是让所有命令实现相同的接口。这个接口通常只有一个没有任何参数的执行方法，让你能在不跟具体命令类耦合的情况下使用同一请求发送者执行不同命令。而且，现在你就能通过在运行时切换连接到发送者的命令对象， 来动态改变发送者的行为。&#x20;</p>
<p>你可能会注意到我们好像遗漏了请求的参数。GUI 对象可以给业 务层对象提供一些参数。但执行命令方法没有任何参数，所以我们怎么把请求的详情发送给接收者呢?</p>
<p>答案是 使用数据对命令进行预先配置， 或者让命令本身能够自行获取数据。&#x20;</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-6.png"></p>
<p>GUI 对象将命令委派给命令对象</p>
<p>让我们回到文本编辑器。应用命令模式后，我们不再需要任何按钮子 类来实现点击行为。我们只需在按钮 Button 基类里添加一个成员变量来存储对于命令对象的引用， 并在点击后执行该命令就可以了。</p>
<p>你需要为每个可能的操作实现一系列命令类，并且根据按钮所需行为 把命令和按钮连接起来。&#x20;</p>
<p>其他菜单、快捷方式或整个对话框等 GUI 元素都可以通过相同方式来实现。当用戶与 GUI 元素交互时，和gui连接的命令就会被执行。讲到这里 你很可能已经猜到了，与相同操作相关的元素会被连接到相同的命令， 从而避免了重复代码。&#x20;</p>
<p>最后，命令成为了减少 GUI 和业务逻辑层之间耦合的中间层。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.Receiver 编辑器核心</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Editor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">StringBuilder</span> content = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getSelection</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> content.<span class="title function_">toString</span>(); <span class="comment">// 实际应按选区范围获取</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">deleteSelection</span>(<span class="params"></span>) &#123;</span><br><span class="line">        content.<span class="title function_">setLength</span>(<span class="number">0</span>); <span class="comment">// 清空选区</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">replaceSelection</span>(<span class="params"><span class="title class_">String</span> text</span>) &#123;</span><br><span class="line">        content.<span class="title function_">replace</span>(<span class="number">0</span>, content.<span class="title function_">length</span>(), text); <span class="comment">// 替换选区</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getContent</span>(<span class="params"></span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> content.<span class="title function_">toString</span>(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.Command 接口层</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">execute</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.具体命令实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CopyCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Editor</span> editor;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> clipboard;  <span class="comment">// 仿系统剪贴板</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">CopyCommand</span>(<span class="title class_">Editor</span> editor) &#123; </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span> = editor; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">execute</span>(<span class="params"></span>) &#123;</span><br><span class="line">        clipboard = editor.<span class="title function_">getSelection</span>(); <span class="comment">// 获取选区存入剪贴板</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PasteCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Editor</span> editor;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> clipboard;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">PasteCommand</span>(<span class="title class_">Editor</span> editor, <span class="title class_">String</span> clipboard) &#123; </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span> = editor;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">clipboard</span> = clipboard;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">execute</span>(<span class="params"></span>) &#123;</span><br><span class="line">        editor.<span class="title function_">replaceSelection</span>(clipboard); <span class="comment">// 用剪贴板内容覆盖选区</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.Invoker触发器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Toolbar</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Command</span> command;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setCommand</span>(<span class="params"><span class="title class_">Command</span> cmd</span>) &#123; <span class="comment">// 动态绑定命令</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">command</span> = cmd; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(command != <span class="literal">null</span>) command.<span class="title function_">execute</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.Client组装结构</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">main</span>(<span class="params"><span class="title class_">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="comment">// 创建核心模块</span></span><br><span class="line">        <span class="title class_">Editor</span> doc = <span class="keyword">new</span> <span class="title class_">Editor</span>(); </span><br><span class="line">        doc.<span class="title function_">replaceSelection</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 建立命令纽带</span></span><br><span class="line">        <span class="title class_">Toolbar</span> copyBtn = <span class="keyword">new</span> <span class="title class_">Toolbar</span>();</span><br><span class="line">        copyBtn.<span class="title function_">setCommand</span>(<span class="keyword">new</span> <span class="title class_">CopyCommand</span>(doc)); <span class="comment">// 绑定复制行为</span></span><br><span class="line">        </span><br><span class="line">        <span class="title class_">Toolbar</span> pasteBtn = <span class="keyword">new</span> <span class="title class_">Toolbar</span>();</span><br><span class="line">        pasteBtn.<span class="title function_">setCommand</span>(<span class="keyword">new</span> <span class="title class_">PasteCommand</span>(doc, <span class="string">&quot;World&quot;</span>)); <span class="comment">// 粘贴命令携带参数</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 用户点击按钮时</span></span><br><span class="line">        copyBtn.<span class="title function_">onClick</span>(); <span class="comment">// 将Hello存入剪贴板</span></span><br><span class="line">        pasteBtn.<span class="title function_">onClick</span>(); <span class="comment">// 文档内容变为World</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>核心设计优势：</p>
<ol>
<li><p><strong>解耦交互</strong>：按钮（Invoker）只需触发 <code>execute()</code>，无需知道具体操作</p>
</li>
<li><p><strong>可扩展性</strong>：新增撤销命令只需增加 <code>UndoCommand</code> 类，无需修改已有逻辑</p>
</li>
<li><p><strong>行为参数化</strong>：可把复制&#x2F;粘贴命令存入历史栈实现撤销重做</p>
</li>
</ol>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-7.png"></p>
<ol>
<li><p>发送者(Sender)⸺亦称“触发者(Invoker)”⸺类负责对请求进行初始化，其中必须包含一个成员变量来存储对于命令对象的 引用。发送者触发命令，而不是向接收者直接发送请求。注意， 发送者并不负责创建命令对象:它通常会通过构造函数从客戶端那边获得预先生成的命令对象。&#x20;</p>
</li>
<li><p>命令(Command)接口通常仅声明一个执行命令的方法。&#x20;</p>
</li>
<li><p>具体命令(Concrete Commands)会实现各种类型的请求。具体命令自身并不完成工作， 而是会把调用委派给一个业务逻辑对象 。但为了简化代码， 这些类可以合并。 而接收对象执行方法所需要的参数可以声明为具体命令的成员变量。你可以把命令对象设为不可变，只允许通过构造函数对这些成员变量进行初始化。&#x20;</p>
</li>
<li><p>接收者(Receiver)类包含部分业务逻辑。几乎任何对象都可以作为接收者。绝大部分命令只要关心怎么把请求传递到接收者，接收者自己会完成实际的工作。&#x20;</p>
</li>
<li><p>客户端(Client)会创建并配置具体命令对象。客戶端必须把 包括 接收者实体在内的所有请求参数传递给命令的构造函数。 之后生成的命令就可以跟一个或多个发送者相关联了。&#x20;</p>
</li>
</ol>
<h1 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h1><h2 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h2><p>迭代器是一种行为设计模式，让你能在不暴露集合底层表现形式(列表、栈和树等)的情况下遍历集合中所有的元素。&#x20;</p>
<h2 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h2><p>集合是编程中最常使用的数据类型之一。 大部分集合使用简单列表存储元素。但有些集合还会使用栈、树、 图 和其他复杂的数据结构。&#x20;</p>
<p>无论集合的构成方式是咋样的，它都必须提供某种访问元素的方式，便于 其他代码使用其中的元素。 集合应提供一种能够遍历元素的方式， 并且保证它不会重复地访问同一个元素。&#x20;</p>
<p>如果你的集合基于列表， 遍历就会比较简单。但怎么遍历复杂数据结构(例如树)中的元素呢? 比如 今天你需要使用深度 优先算法来遍历树结构， 明天可能会需要广度优先算法; 下周则可能会需要其他方式(比如随机存取树中的元素)。&#x20;</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-14.png"></p>
<p>需要通过不同的方式遍历相同的集合</p>
<p>这个时候，你可能不断往集合里添加遍历算法，这会让集合本身的职责（“高效存储数据” ）变得模糊，不符合单一职责原则。另外 有些算法可能是根据特定应用订制的， 把他加到泛型集合类中会 显得非常奇怪。&#x20;</p>
<p>另一方面， 使用多种集合的客户端代码可能并不关心存储数据的方式，不过由于集合提供不同的元素访问方式， 你的代码就不得不跟特定集合类进行耦合。&#x20;</p>
<h2 id="解决-2"><a href="#解决-2" class="headerlink" title="解决"></a>解决</h2><p>迭代器模式的主要思想是将集合的遍历行为抽取成单独的迭代器对象。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-3.png"></p>
<p>迭代器可实现多种遍历算法。 多个迭代器对象可同时遍历同一个集合&#x20;</p>
<p>除实现自身算法外， 迭代器还封装了遍历操作的所有细节， 比如当前 位置和末尾剩余元素的数量。 因此，多个迭代器可以在相互独立的情况下同时访问集合。&#x20;</p>
<p>迭代器通常会提供一个获取集合元素的基本方法。 客户端可以不断调用这个方法直到它不返回任何内容， 也就是说迭代器已经遍历了所有元素。</p>
<p>所有迭代器必须实现相同的接口。这样一来，只要有合适的迭代器，客户端代码就能兼容任何类型的集合或遍历算法。 如果你需要采用特殊方式来遍历集合， 只需创建一个新的迭代器类即可， 不需要对集合或客户端进行修改。 &#x20;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.Iterator接口 (定义遍历标准)</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TreeIterator</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span>;</span><br><span class="line">    T <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.Concrete Iterator（实现广度优先遍历）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BfsIterator</span> <span class="keyword">implements</span> <span class="title class_">TreeIterator</span>&lt;TreeNode&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BfsIterator</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root != <span class="literal">null</span>) queue.add(root);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;   <span class="comment">// 判断是否有下一节点</span></span><br><span class="line">        <span class="keyword">return</span> !queue.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">next</span><span class="params">()</span> &#123;     <span class="comment">// 按层遍历树节点</span></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">current</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">        <span class="keyword">for</span>(TreeNode child : current.getChildren()) &#123;</span><br><span class="line">            queue.add(child);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> current;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.Collection接口（树结构抽象）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TreeCollection</span> &#123;</span><br><span class="line">    TreeIterator&lt;TreeNode&gt; <span class="title function_">createBfsIterator</span><span class="params">()</span>; <span class="comment">// 创建特定迭代器</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.Concrete Collection（树节点实现）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeNode</span> <span class="keyword">implements</span> <span class="title class_">TreeCollection</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String data;</span><br><span class="line">    <span class="keyword">private</span> List&lt;TreeNode&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TreeNode</span><span class="params">(String data)</span> &#123; </span><br><span class="line">        <span class="built_in">this</span>.data = data; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addChild</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">        children.add(node);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;TreeNode&gt; <span class="title function_">getChildren</span><span class="params">()</span> &#123; </span><br><span class="line">        <span class="keyword">return</span> children; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> TreeIterator&lt;TreeNode&gt; <span class="title function_">createBfsIterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BfsIterator</span>(<span class="built_in">this</span>); <span class="comment">// 自身作为遍历起点</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.Client使用示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/* 构建树结构：</span></span><br><span class="line"><span class="comment">           A</span></span><br><span class="line"><span class="comment">          / \</span></span><br><span class="line"><span class="comment">         B   C</span></span><br><span class="line"><span class="comment">            / \</span></span><br><span class="line"><span class="comment">           D   E</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">nodeB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">nodeC</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">        root.addChild(nodeB);</span><br><span class="line">        root.addChild(nodeC);</span><br><span class="line">        nodeC.addChild(<span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="string">&quot;D&quot;</span>));</span><br><span class="line">        nodeC.addChild(<span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="string">&quot;E&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取BFS迭代器</span></span><br><span class="line">        TreeIterator&lt;TreeNode&gt; iterator = root.createBfsIterator();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 遍历树节点</span></span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext()) &#123;</span><br><span class="line">            System.out.println(iterator.next().data); </span><br><span class="line">            <span class="comment">// 依次输出 A → B → C → D → E</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>设计关键点：</p>
<ol>
<li><p><strong>解耦遍历算法</strong>：BfsIterator封装广度优先的具体逻辑</p>
</li>
<li><p><strong>扩展性强</strong>：新增DfsIterator无需修改树结构代码</p>
</li>
<li><p><strong>多态迭代</strong>：客户端通过统一接口操作不同遍历方式</p>
</li>
</ol>
<h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-5.png"></p>
<ol>
<li><p>(Iterator)接口声明了遍历集合所需的操作:获取下一个元素、 获取当前位置和重新开始迭代等。&#x20;</p>
</li>
<li><p>(Concrete Iterators)实现遍历集合的一种特定算法。迭代器对象必须跟踪自身遍历的进度。这就让多个迭代器可以相互独立地遍历同一集合。&#x20;</p>
</li>
<li><p>(Collection) 接口声明一个或多个方法来获取与集合兼容的迭代器。注意，方法返回的类型必须被声明成迭代器接口， 这样具体集合可以返回各种不同种类的迭代器。&#x20;</p>
</li>
<li><p>(Concrete Collections)会在客户端请求迭代器时返回一个特定的具体迭代器类实体。</p>
</li>
<li><p>(Client) 通过集合和迭代器的接口来和这两者进行交互。 这样一来,客户端不需要跟具体类耦合，允许同一客户端代码使用各种不同的集合和迭代器。 客户端通常不会自行创建迭代器，而是会从集合里获取。但在特定情况下，客户端可以直接创建一个迭代器(比如当客户端需要自定义特殊迭代器时)。&#x20;</p>
</li>
</ol>
<h1 id="中介者"><a href="#中介者" class="headerlink" title="中介者"></a>中介者</h1><h2 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h2><p>中介者是一种行为设计模式， 能让你减少对象之间混乱无序的依赖关系。该模式会限制对象之间的直接交互，强制让它们通过一个中介者对象进行合作。&#x20;</p>
<h2 id="问题-2"><a href="#问题-2" class="headerlink" title="问题"></a>问题</h2><p>假如你有一个创建和修改用户资料的对话框，它由各种控件组成，例如文本框 ( T e x t F i e l d )、 复 选框 ( C h e c k b o x ) 和按钮 ( B u t t o n ) 等 。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-13.png"></p>
<p>&#x20;用戶界面中各元素间的关系会随程序发展而变得混乱</p>
<p>某些表单元素之间可能会直接进行互动。比如，选中“我有一只猫”复选框后可能会显示一个隐藏文本框用于输入猫咪的名字。另一个例子是点击提交按钮后需要校验所有输入的内容。&#x20;</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-4.png"></p>
<p>元素间存在许多关联。 所以对某些元素进行修改可能会影响其他元素。&#x20;</p>
<p>另外，如果直接在表单元素代码中实现业务逻辑，你就很难在程序其他表单中复用这些元素类。比如，由于复选框类与猫咪的文本框相耦合，所以就不能在其他表单中使用该复选框。所以要么使用渲染表单时用到的所有类， 要么一个都不用。&#x20;</p>
<h2 id="解决-3"><a href="#解决-3" class="headerlink" title="解决"></a>解决</h2><p>中介者模式建议你停止组件之间的直接调用，让他们相互独立。这些组件必须调用中介者对象，通过中介者对象重定向调用行为，用间接的方式进行合作。最终，组件只依赖于一个中介者类，无需跟多个其他组件相耦合。&#x20;</p>
<p>在编辑表单的例子中，对话框(Dialog) 类本身可以作为中介者 ，他很可能知道自己所有的子元素，因此不需要在这个类里引入新的依赖关系。&#x20;</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-26.png"></p>
<p>UI 元素必须通过中介者对象进行间接沟通。&#x20;</p>
<p>绝大部分重要的修改都在实际表单元素里进行。 我们还是回到提交按钮。之前，当用戶点击按钮后，它必须对所有表单内容进行校验。而 现在它的唯一工作是把点击事件通知给对话框。收到通知后，对话框可以自行校验数值或把任务委派给各个元素。这样一来，按钮不再与多个表单元素相关联， 而只依赖于对话框类。&#x20;</p>
<p>你还可以为所有类型的对话框抽取通用接口，进一步削弱它的依赖性。接口里声明一个所有表单元素都能使用的通知方法，可用于把元素中发生的事件通知给对话框。这样一来，所有实现了这个接口的对话框都能使用这个提交按钮了。&#x20;</p>
<p>采用这种方式，中介者模式让你能在单个中介者对象中封装多个对象之间的复杂关系网。我们知道，类所拥有的依赖关系越少，就越易于修改、扩展或 复用。&#x20;</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.Mediator接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">DialogMediator</span> &#123;</span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">notify</span>(<span class="title class_">Component</span> sender, <span class="title class_">String</span> event); <span class="comment">// 统一事件通知口</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.Concrete Mediator（登录对话框）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginDialogMediator</span> <span class="keyword">implements</span> <span class="title class_">DialogMediator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">CheckBox</span> rememberMeBox;   <span class="comment">// ComponentA</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">TextBox</span> usernameTextBox;  <span class="comment">// ComponentB</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">TextBox</span> passwordTextBox;  <span class="comment">// ComponentC</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Button</span> submitButton;      <span class="comment">// ComponentD</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">LoginDialogMediator</span>() &#123;</span><br><span class="line">        <span class="comment">// 组件在中介内创建并建立双向引用</span></span><br><span class="line">        rememberMeBox = <span class="keyword">new</span> <span class="title class_">CheckBox</span>(<span class="variable language_">this</span>);</span><br><span class="line">        usernameTextBox = <span class="keyword">new</span> <span class="title class_">TextBox</span>(<span class="variable language_">this</span>);</span><br><span class="line">        passwordTextBox = <span class="keyword">new</span> <span class="title class_">TextBox</span>(<span class="variable language_">this</span>);</span><br><span class="line">        submitButton = <span class="keyword">new</span> <span class="title class_">Button</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">notify</span>(<span class="params"><span class="title class_">Component</span> sender, <span class="title class_">String</span> event</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sender == rememberMeBox &amp;&amp; event.<span class="title function_">equals</span>(<span class="string">&quot;check&quot;</span>)) &#123;</span><br><span class="line">            <span class="title function_">toggleRememberMeConfig</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((sender == usernameTextBox || sender == passwordTextBox) </span><br><span class="line">                   &amp;&amp; event.<span class="title function_">equals</span>(<span class="string">&quot;keypress&quot;</span>)) &#123;</span><br><span class="line">            <span class="title function_">validateForm</span>(); <span class="comment">// 实时校验表单</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sender == submitButton &amp;&amp; event.<span class="title function_">equals</span>(<span class="string">&quot;click&quot;</span>)) &#123;</span><br><span class="line">            <span class="title function_">handleSubmit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">void</span> <span class="title function_">toggleRememberMeConfig</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;记住密码配置更改：&quot;</span> + rememberMeBox.<span class="title function_">isChecked</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">void</span> <span class="title function_">validateForm</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="built_in">boolean</span> isValid = !usernameTextBox.<span class="title function_">getText</span>().<span class="title function_">isEmpty</span>() &amp;&amp; </span><br><span class="line">                          passwordTextBox.<span class="title function_">getText</span>().<span class="title function_">length</span>() &gt;= <span class="number">6</span>;</span><br><span class="line">        submitButton.<span class="title function_">setEnabled</span>(isValid); <span class="comment">// 联合控制按钮状态</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">void</span> <span class="title function_">handleSubmit</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;提交用户：&quot;</span> + usernameTextBox.<span class="title function_">getText</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.Components实现</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="title class_">DialogMediator</span> dialog; <span class="comment">// 持中介引用</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Component</span>(<span class="title class_">DialogMediator</span> dialog) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dialog</span> = dialog;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">void</span> <span class="title function_">triggerEvent</span>(<span class="title class_">String</span> event);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CheckBox</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123; <span class="comment">// ComponentA</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">boolean</span> checked;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">CheckBox</span>(<span class="title class_">DialogMediator</span> dialog) &#123; <span class="variable language_">super</span>(dialog); &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">toggle</span>(<span class="params"></span>) &#123;</span><br><span class="line">        checked = !checked;</span><br><span class="line">        dialog.<span class="title function_">notify</span>(<span class="variable language_">this</span>, <span class="string">&quot;check&quot;</span>); <span class="comment">// 通知中介</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">boolean</span> <span class="title function_">isChecked</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> checked; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">triggerEvent</span>(<span class="params"><span class="title class_">String</span> event</span>) &#123; <span class="title function_">toggle</span>(); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextBox</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123; <span class="comment">// ComponentB/C</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> text = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">TextBox</span>(<span class="title class_">DialogMediator</span> dialog) &#123; <span class="variable language_">super</span>(dialog); &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">input</span>(<span class="params"><span class="title class_">String</span> text</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">text</span> = text;</span><br><span class="line">        dialog.<span class="title function_">notify</span>(<span class="variable language_">this</span>, <span class="string">&quot;keypress&quot;</span>); <span class="comment">// 实时反馈输入</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getText</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> text; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">triggerEvent</span>(<span class="params"><span class="title class_">String</span> event</span>) &#123; <span class="title function_">input</span>(event); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123; <span class="comment">// ComponentD</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">boolean</span> enabled = <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Button</span>(<span class="title class_">DialogMediator</span> dialog) &#123; <span class="variable language_">super</span>(dialog); &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">click</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(enabled) dialog.<span class="title function_">notify</span>(<span class="variable language_">this</span>, <span class="string">&quot;click&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setEnabled</span>(<span class="params"><span class="built_in">boolean</span> state</span>) &#123;</span><br><span class="line">        enabled = state;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;按钮状态：&quot;</span> + (state?<span class="string">&quot;可用&quot;</span>:<span class="string">&quot;禁用&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">triggerEvent</span>(<span class="params"><span class="title class_">String</span> event</span>) &#123; <span class="title function_">click</span>(); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.Client使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthDialogClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">main</span>(<span class="params"><span class="title class_">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="title class_">LoginDialogMediator</span> dialog = <span class="keyword">new</span> <span class="title class_">LoginDialogMediator</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 模拟用户交互流程</span></span><br><span class="line">        dialog.<span class="title function_">getUsernameTextBox</span>().<span class="title function_">triggerEvent</span>(<span class="string">&quot;john&quot;</span>);     <span class="comment">// 输入用户名</span></span><br><span class="line">        dialog.<span class="title function_">getPasswordTextBox</span>().<span class="title function_">triggerEvent</span>(<span class="string">&quot;123456&quot;</span>);   <span class="comment">// 输入密码</span></span><br><span class="line">        dialog.<span class="title function_">getSubmitButton</span>().<span class="title function_">triggerEvent</span>(<span class="string">&quot;click&quot;</span>);       <span class="comment">// 成功提交</span></span><br><span class="line">        </span><br><span class="line">        dialog.<span class="title function_">getRememberMeBox</span>().<span class="title function_">triggerEvent</span>(<span class="string">&quot;check&quot;</span>);      <span class="comment">// 切换&quot;记住我&quot;</span></span><br><span class="line">        dialog.<span class="title function_">getPasswordTextBox</span>().<span class="title function_">triggerEvent</span>(<span class="string">&quot;123&quot;</span>);      <span class="comment">// 触发按钮禁用</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>架构优势：</p>
<ol>
<li><p><strong>解耦组件</strong>：各组件仅依赖中介对象，无直接关联</p>
</li>
<li><p><strong>集中控制</strong>：表单验证逻辑统一在<code>validateForm()</code>处理</p>
</li>
<li><p><strong>扩展灵活</strong>：新增密码强度校验组件时不影响现有结构</p>
</li>
</ol>
<h2 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-15.png"></p>
<ol>
<li><p>组件(Component)是各种包含业务逻辑的类。每个组件都有一 个指向中介者的引用，这个引用被声明成中介者接口类型。组件不知道中介者实际所属的类，因此你可以通过把它连接到不同的中介者来让它能在其他程序里复用。&#x20;</p>
</li>
<li><p>中介者(Mediator)接口声明了与组件交流的方法，但通常只包 括一个通知方法。组件可把任意上下文(包括自己的对象)作为 这个方法的参数， 只有这样接收组件和发送者类之间才不会耦合。&#x20;</p>
</li>
<li><p>具体中介者(Concrete Mediator) 封装了多种组件间的关系。 具体中介者通常会保存所有组件的引用并对其进行管理，甚至有时会对它的生命周期进行管理。&#x20;</p>
</li>
<li><p>组件并不知道其他组件的情况。如果组件内发生了重要事件， 它只能通知中介者。中介者收到通知后能轻易地确定发送者，这就已经足够判断接下来需要触发的组件了。 对于组件来说，中介者看上去完全就是一个黑箱。发送者不知道最终会由谁来处理自己的请求，接收者也不知道最初是谁发出了请求。&#x20;</p>
</li>
</ol>
<h1 id="备忘录"><a href="#备忘录" class="headerlink" title="备忘录"></a>备忘录</h1><h2 id="简介-4"><a href="#简介-4" class="headerlink" title="简介"></a>简介</h2><p>备忘录是一种行为设计模式， 允许在不暴露对象实现细节的情况下保存和恢复对象之前的状态。&#x20;</p>
<h2 id="问题-3"><a href="#问题-3" class="headerlink" title="问题"></a>问题</h2><p>假如你正在开发一款文字编辑器应用。你想加入撤销功能。你可以采用直接的方式来实现: 程序在执行任何操作前会记录所有的对象状态，并把它们保存下来。当用戶需要撤销某个操作的时候，程序会从历史记录里获取最近的快照，然后使用它来恢复所有对象的状态。&#x20;</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-23.png"></p>
<p>程序在执行操作前保存所有对象的状态快照， 稍后可使用快照将对象恢复到之前的状态。&#x20;</p>
<p>让我们来想一下这些状态快照。 首先， 到底该怎么生成一个快照呢？你很可能会需要遍历对象的所有成员变量并且把他们的数值复制保存，但这也只有在对象对它的内容没有严格访问权限限制的情况 下，你才能用这种方式。 不过，绝大部分对象都会用私有成员变量来存储重要数据，所以这种方案可能比较麻烦。&#x20;</p>
<p>那我们假设对象都会公开它的所有状态。尽管这能解决当前问题，但如果之后你想添加或删除一些成员变量，你可能需要更改负责复制这些对象状态的类。&#x20;</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-25.png"></p>
<p>如何复制对象的私有状态?</p>
<p>还有更多问题。比如，让我们来考虑下编辑器(Editor)状态的实际“快照”，它需要包含哪些数据? 首先至少必须包含实际的文本、光标坐标和当前滚动条位置等。你需要收集这些数据并把它们放在特定容器中，才能生成快照。&#x20;</p>
<p>你很可能会把大量的容器对象存储在历史记录列表中。这些容器大概率是由同一个类生成的对象。这个类中几乎没有方法，但有许多与编辑器状态一一对应的成员变量。为了让其他对象能保存或读取快照，你需要将快照的成员变量设为公有，它会暴露所有编辑器状态。其他类会对快照类的每个小改动产生依赖，除非这些改动仅存在于私有成员变量或方法中。&#x20;</p>
<p>我们似乎走进了一条死胡同:要么会暴露类的所有内部细节而使它过于脆弱;要么会限制对其状态的访问权限而无法生成快照。那么，我们还有其他方式来实现“撤销”功能吗?&#x20;</p>
<h2 id="解决-4"><a href="#解决-4" class="headerlink" title="解决"></a>解决</h2><p>我们刚才遇到的所有问题都是封装“破损”造成的。一些对象在执行某些行为时需要获取数据，所以它们侵入了其他对象的私有空间， 而不是让这些对象自己完成工作。</p>
<p>备忘录模式把创建状态快照(Snapshot)的工作委派给实际状态的拥有者即原发器(Originator)对象。这样其他对象就不再需要从“外部”复制编辑器状态了，编辑器类拥有状态的完全访问权，因此可以自行生成快照。&#x20;</p>
<p>该模式建议把对象状态的副本存储在一个名为备忘录(Memento)的特殊对象里。除了负责创建备忘录的对象外，任何对象都不能访问备忘录的内容。其他对象必须使用受限接口跟备忘录进行交互，它们可以获取快照的元数据(创建时间和操作名称等)，但不能获取快照中原始对象的状态。&#x20;</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-24.png"></p>
<p>原发器拥有对备忘录的完全访问权限， 其他对象只能访问元数据。&#x20;</p>
<p>这种限制策略允许你把备忘录保存在被称为负责人(Caretakers ）的对象里。由于负责人只通过受限接口和备忘录互动，所以它不能修改存储在备忘录内部的状态。同时，原发器拥有对备忘录所有成员的访问权限， 从而能随时恢复自己以前的状态。&#x20;</p>
<p>在文字编辑器的示例中，我们可以创建一个独立的历史(History) 类作为负责人。编辑器每次执行操作前，存储在负责人中的备忘录栈都会生⻓。你甚至可以在应用的 UI 中渲染这个栈，为用戶显示所有的操作历史。&#x20;</p>
<p>当用戶触发撤销操作时，历史类会从栈里取回最近的备忘录，并把它传递给编辑器来请求进行回滚。由于编辑器拥有对备忘录的完全访问权限， 它就可以从备忘录中获取数值，用来替换自身的状态。&#x20;</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Originator：文本编辑器核心类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextEditor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> content; <span class="comment">// 当前编辑内容</span></span><br><span class="line">    <span class="keyword">private</span> int cursorPosition; <span class="comment">// 光标位置</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">type</span>(<span class="params"><span class="title class_">String</span> words</span>) &#123;</span><br><span class="line">        content = (content == <span class="literal">null</span>) ? words : content.<span class="title function_">substring</span>(<span class="number">0</span>, cursorPosition) </span><br><span class="line">                + words + content.<span class="title function_">substring</span>(cursorPosition);</span><br><span class="line">        cursorPosition += words.<span class="title function_">length</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setCursor</span>(<span class="params">int position</span>) &#123; </span><br><span class="line">        cursorPosition = <span class="title class_">Math</span>.<span class="title function_">min</span>(position, content.<span class="title function_">length</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建备忘录</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">EditorMemento</span> <span class="title function_">createMemento</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EditorMemento</span>(content, cursorPosition); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从备忘录恢复</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">restoreFromMemento</span>(<span class="params"><span class="title class_">EditorMemento</span> memento</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">content</span> = memento.<span class="title function_">getSavedContent</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cursorPosition</span> = memento.<span class="title function_">getSavedCursorPosition</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Memento作为内部类（封装状态细节）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EditorMemento</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> final <span class="title class_">String</span> content;</span><br><span class="line">        <span class="keyword">private</span> final int cursorPosition;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> <span class="title class_">EditorMemento</span>(<span class="title class_">String</span> content, int cursor) &#123; <span class="comment">// 仅Originator可创建实例</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">content</span> = content;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cursorPosition</span> = cursor;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title class_">String</span> <span class="title function_">getSavedContent</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> content; &#125; <span class="comment">// 包权限访问</span></span><br><span class="line">        <span class="keyword">private</span> int <span class="title function_">getSavedCursorPosition</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> cursorPosition; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Caretaker：历史记录管理器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">History</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> final <span class="title class_">Stack</span>&lt;<span class="title class_">TextEditor</span>.<span class="property">EditorMemento</span>&gt; mementos = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">save</span>(<span class="params"><span class="title class_">TextEditor</span>.<span class="title class_">EditorMemento</span> memento</span>) &#123;</span><br><span class="line">        mementos.<span class="title function_">push</span>(memento); <span class="comment">// 保存状态快照[^2]</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">TextEditor</span>.<span class="property">EditorMemento</span> <span class="title function_">undo</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(mementos.<span class="title function_">size</span>() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            mementos.<span class="title function_">pop</span>(); <span class="comment">// 移除当前状态</span></span><br><span class="line">            <span class="keyword">return</span> mementos.<span class="title function_">peek</span>(); <span class="comment">// 返回前一次状态</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mementos.<span class="title function_">peek</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Client使用示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EditorClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">main</span>(<span class="params"><span class="title class_">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="title class_">TextEditor</span> editor = <span class="keyword">new</span> <span class="title class_">TextEditor</span>();</span><br><span class="line">        <span class="title class_">History</span> history = <span class="keyword">new</span> <span class="title class_">History</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第一次输入并保存</span></span><br><span class="line">        editor.<span class="title function_">type</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">        history.<span class="title function_">save</span>(editor.<span class="title function_">createMemento</span>()); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二次输入并保存</span></span><br><span class="line">        editor.<span class="title function_">type</span>(<span class="string">&quot; World&quot;</span>);</span><br><span class="line">        history.<span class="title function_">save</span>(editor.<span class="title function_">createMemento</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行撤销操作（状态退回第一次保存点）</span></span><br><span class="line">        editor.<span class="title function_">restoreFromMemento</span>(history.<span class="title function_">undo</span>()); </span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(editor.<span class="title function_">getContent</span>()); <span class="comment">// 输出 &quot;Hello&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关键实现要点：</p>
<ol>
<li><p><strong>严格封装</strong>：Memento的构造器和访问方法仅对Originator可见</p>
</li>
<li><p><strong>状态融合</strong>：Originator内部维护状态恢复逻辑</p>
</li>
<li><p><strong>历史管理</strong>：Caretaker用栈结构实现撤销机制</p>
</li>
<li><p><strong>数据安全</strong>：Memento对象不可变，确保快照完整性</p>
</li>
</ol>
<p>功能扩展方向：</p>
<ul>
<li><p>增加保存选项（字体&#x2F;排版）到Memento</p>
</li>
<li><p>支持重做功能（双栈实现）</p>
</li>
<li><p>持久化备忘录（保存到文件）</p>
</li>
</ul>
<h2 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-29.png"></p>
<ol>
<li><p>原发器(Originator)类可以生成自身状态的快照，也可以在需要时通过快照恢复自身状态。&#x20;</p>
</li>
<li><p>备忘录(Memento)是原发器状态快照的值对象(value object) ，通常做法是把备忘录设为不可变的，通过构造函数一次性传递数据。&#x20;</p>
</li>
<li><p>负责人(Caretaker)只知道“何时”和“为何”捕捉原发器的状态， 以及何时恢复状态。 负责人通过保存备忘录栈来记录原发器的历史状态。当原发器需要回滚时，负责人会从栈里获取最顶部的备忘录，并把它传递给原发器的恢复(restoration)方法。&#x20;</p>
</li>
<li><p>在这个实现方法中，备忘录类会被嵌套在原发器中。这样原发器就可以访问备忘录的成员变量和方法， 就算这些方法被声明为私有；另一方面，负责人对于备忘录的成员变量和方法的访问权限非常有限: 它们只能在栈中保存备忘录， 但不能修改它的状态。&#x20;</p>
</li>
</ol>
<h1 id="观察者"><a href="#观察者" class="headerlink" title="观察者"></a>观察者</h1><h2 id="简介-5"><a href="#简介-5" class="headerlink" title="简介"></a>简介</h2><p>观察者是一种行为设计模式， 允许你定义一种订阅通知机制， 可在事件发生时通知多个“观察&#x2F;订阅”该对象的其他对象。&#x20;</p>
<h2 id="问题-4"><a href="#问题-4" class="headerlink" title="问题"></a>问题</h2><p>假如你有两种类型的对象: 顾客和商店。顾客对某个新品非常感兴趣，他可以每天来商店看产品是否到货。但如果商品尚未到货时，顾客就会空手而归。&#x20;</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-27.png"></p>
<p>前往商店和发送垃圾邮件&#x20;</p>
<p>或者，每次产品到货时，商店可以向所有顾客发送邮件。这样，部分顾客就无需反复前往商店了，但也可能会惹恼对新品没有兴趣的其他顾客。&#x20;</p>
<p>我们似乎遇到了一个矛盾:要么让顾客浪费时间检查产品是否到货，要么让商店去通知所有顾客。&#x20;</p>
<h2 id="解决-5"><a href="#解决-5" class="headerlink" title="解决"></a>解决</h2><p>拥有被关注状态的对象，比如商店，通常被称为目标，由于它要在自身状态改变时通知给其他对象，我们也将其称为发布者(publisher)。 所有关注发布者状态变化的其他对象被称为订阅者(subscribers)，比如顾客。&#x20;</p>
<p>观察者模式建议你为发布者类添加订阅机制，让每个对象都能订阅或取消订阅发布者的事件。这个机制包括 ：</p>
<ol>
<li><p>一个成员变量，它是一个列表，用于存储所有订阅者对象的引用。</p>
</li>
<li><p>几个用于添加或删除列表中订阅者的公有方法。&#x20;</p>
</li>
</ol>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-21.png"></p>
<p>订阅机制允许对象订阅事件通知。</p>
<p>如果发生了发布者事件，它就要遍历订阅者并调用其对象的特定通知方法。&#x20;</p>
<p>实际应用中可能会有十几个不同的订阅者类订阅同一个发布者类的事件，你不希望发布者与所有这些类相耦合。此外如果别人也会订阅这个发布者类， 你甚至不知道这些订阅者类是什么。&#x20;</p>
<p>因此，所有订阅者都必须实现同样的接口，发布者仅通过该接口与订阅者交互。接口中必须声明通知方法及其参数，这样发布者在发出通知时还能传递一些上下文数据。&#x20;</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-28.png"></p>
<p>发布者调用订阅者对象中的特定通知方法来通知订阅者。</p>
<p>如果你的应用中有多个不同类型的发布者，且希望订阅者可兼容所有发布者，那么你甚至可以进一步让所有订阅者遵循同样的接口。该接口仅需定义几个订阅方法即可。这样订阅者就能在不与具体发布者类 耦合的情况下通过接口订阅发布者的状态变化通知。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Publisher 接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">StorePublisher</span> &#123;</span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">subscribe</span>(<span class="title class_">CustomerSubscriber</span> subscriber);</span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">unsubscribe</span>(<span class="title class_">CustomerSubscriber</span> subscriber);</span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">notifySubscribers</span>(<span class="title class_">String</span> product);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体 Publisher 类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IPhoneStore</span> <span class="keyword">implements</span> <span class="title class_">StorePublisher</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">List</span>&lt;<span class="title class_">CustomerSubscriber</span>&gt; customers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">subscribe</span>(<span class="params"><span class="title class_">CustomerSubscriber</span> subscriber</span>) &#123;</span><br><span class="line">        customers.<span class="title function_">add</span>(subscriber);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">unsubscribe</span>(<span class="params"><span class="title class_">CustomerSubscriber</span> subscriber</span>) &#123;</span><br><span class="line">        customers.<span class="title function_">remove</span>(subscriber);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">notifySubscribers</span>(<span class="params"><span class="title class_">String</span> product</span>) &#123;  <span class="comment">// 触发所有订阅者更新 </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="title class_">CustomerSubscriber</span> customer : customers) &#123;</span><br><span class="line">            customer.<span class="title function_">update</span>(product);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">restockProduct</span>(<span class="params"><span class="title class_">String</span> product</span>) &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;新品到货：&quot;</span> + product);</span><br><span class="line">        <span class="title function_">notifySubscribers</span>(product);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Subscriber 接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">CustomerSubscriber</span> &#123;</span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">update</span>(<span class="title class_">String</span> product);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体 Subscriber 类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PremiumCustomer</span> <span class="keyword">implements</span> <span class="title class_">CustomerSubscriber</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">PremiumCustomer</span>(<span class="title class_">String</span> name) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">update</span>(<span class="params"><span class="title class_">String</span> product</span>) &#123;  <span class="comment">// 实现标准通知接口</span></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;[尊享客户]&quot;</span> + name + <span class="string">&quot;，您关注的&quot;</span> + product + <span class="string">&quot;已到店&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Client 客户端配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObserverDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">main</span>(<span class="params"><span class="title class_">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="title class_">IPhoneStore</span> store = <span class="keyword">new</span> <span class="title class_">IPhoneStore</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="title class_">CustomerSubscriber</span> alice = <span class="keyword">new</span> <span class="title class_">PremiumCustomer</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">        <span class="title class_">CustomerSubscriber</span> bob = <span class="keyword">new</span> <span class="title class_">PremiumCustomer</span>(<span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 动态添加订阅</span></span><br><span class="line">        store.<span class="title function_">subscribe</span>(alice);</span><br><span class="line">        store.<span class="title function_">subscribe</span>(bob);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 模拟到货事件</span></span><br><span class="line">        store.<span class="title function_">restockProduct</span>(<span class="string">&quot;iPhone15&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 动态移除订阅</span></span><br><span class="line">        store.<span class="title function_">unsubscribe</span>(bob);</span><br><span class="line">        store.<span class="title function_">restockProduct</span>(<span class="string">&quot;iPhone15 Pro&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关键实现说明：</p>
<ol>
<li><p><code>IPhoneStore</code> 作为具体发布者，实现订阅管理和产品到货通知</p>
</li>
<li><p>通过接口解耦使得新订阅者类型可以扩展而不影响发布者</p>
</li>
<li><p>客户端通过<code>subscribe()</code>&#x2F;<code>unsubscribe()</code>动态维护订阅列表</p>
</li>
</ol>
<h2 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-20.png"></p>
<ol>
<li><p>发布者(Publisher)会向其他对象发送事件。事件会在发布者自身状态改变或执行特定行为后发生。发布者中包含一个加入新订阅者和当前删除旧订阅者的方法。&#x20;</p>
</li>
<li><p>当新事件发生时，发送者会遍历订阅列表并调用每个订阅者对象 的通知方法。 这个方法是在订阅者接口中声明的。&#x20;</p>
</li>
<li><p>订阅者(Subscriber)接口声明了通知接口。在绝大多数情况下 这个接口只包含一个 update 更新 方法。 该方法可以拥有多个参 数， 让发布者能在事件发生时传递事件的详细信息。&#x20;</p>
</li>
<li><p>具体订阅者(Concrete Subscribers) 可以执行一些操作来回应发布者的通知。所有具体订阅者类都实现了同样的接口，所以发布者不需要与具体类相耦合。&#x20;</p>
</li>
<li><p>订阅者通常需要一些上下文信息来正确地处理更新。所以发布者通常会把一些上下文数据作为通知方法的参数。 发布者也可以把自己作为参数进行传递，使订阅者直接获取所需的数据&#x20;</p>
</li>
<li><p>客户端(Client)会分别创建发布者和订阅者对象，然后向发布者注册订阅者。&#x20;</p>
</li>
</ol>
<h1 id="状态"><a href="#状态" class="headerlink" title="状态"></a>状态</h1><h2 id="简介-6"><a href="#简介-6" class="headerlink" title="简介"></a>简介</h2><p>状态是一种行为设计模式，让你能在一个对象的内部状态变化时改变其行为，使其看上去就像改变了自身所属的类一样。</p>
<h2 id="问题-5"><a href="#问题-5" class="headerlink" title="问题"></a>问题</h2><p>状态模式与有限状态机的概念紧密相关。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-19.png"></p>
<p>有限状态机的主要思想是程序在任意时刻仅可处于几种有限的状态中。 在任何一个状态中， 程序的行为都不相同， 并且可以瞬间从一个状态切换到 另一个状态。 根据当前状态， 程序可能会切换到另外一种状态， 也可能会保持当前状态不变。 这些数量有限且预先定义的状态切换规则就是状态转移。&#x20;</p>
<p>你可以把这个方法应用在对象上。 假如你有一个 文档Document类。 文档可能会处于草稿Draft 、 审阅中Moderation和已发布Published三种状态中的一种。 文档的 publish发布方法在不同状态下的行为略有不同:&#x20;</p>
<p>处于草稿状态时， 发布方法会把状态转移到审阅中。</p>
<p>处于审阅中状态时， 如果当前用户是管理员， 发布方法会公开发布文档。&#x20;</p>
<p>处于已发布状态时， 它不会进行任何操作。&#x20;</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-18.png"></p>
<p>文档对象的全部状态和转移。</p>
<p>状态机通常由众多条件运算符 ( if或 switch ) 实现， 可根据对象的当前状态选择相应的行为。 即使你之前从未听说过有限状态机， 你也很可能已经实现过状态模式。 下面的代码应该能帮助你回忆起来。&#x20;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Document</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">state</span> <span class="operator">=</span> <span class="string">&quot;draft&quot;</span>; <span class="comment">// 初始状态为草稿</span></span><br><span class="line">    <span class="keyword">private</span> User currentUser; <span class="comment">// 伪代码中的currentUser需要具体实现</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">publish</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (state) &#123; <span class="comment">// 基于状态的条件分支</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;draft&quot;</span>:</span><br><span class="line">                state = <span class="string">&quot;moderation&quot;</span>;</span><br><span class="line">                System.out.println(<span class="string">&quot;文档进入审核状态&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;moderation&quot;</span>:</span><br><span class="line">                <span class="keyword">if</span> (currentUser != <span class="literal">null</span> &amp;&amp; <span class="string">&quot;admin&quot;</span>.equals(currentUser.getRole())) &#123;</span><br><span class="line">                    state = <span class="string">&quot;published&quot;</span>;</span><br><span class="line">                    System.out.println(<span class="string">&quot;文档正式发布&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;published&quot;</span>:</span><br><span class="line">                System.out.println(<span class="string">&quot;文档已发布，无需操作&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;非法状态: &quot;</span> + state);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// User相关类需要自行实现</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String role;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String role)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.role = role;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getRole</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> role;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置当前用户</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCurrentUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.currentUser = user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 管理员操作</span></span><br><span class="line">        doc.setCurrentUser(<span class="keyword">new</span> <span class="title class_">Document</span>.User(<span class="string">&quot;admin&quot;</span>));</span><br><span class="line">        doc.publish(); <span class="comment">// Draft → Moderation</span></span><br><span class="line">        doc.publish(); <span class="comment">// Moderation → Published</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 普通用户操作</span></span><br><span class="line">        doc.setCurrentUser(<span class="keyword">new</span> <span class="title class_">Document</span>.User(<span class="string">&quot;user&quot;</span>));</span><br><span class="line">        doc.publish(); <span class="comment">// 保持Published状态</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当我们逐步在文档类中添加更多状态和依赖于状态的行为后， 基于条件语句的状态机就会出问题。 为了能根据当前状态选择相应行为， 绝大部分方法里都会包含复杂的条件语句。 修改转换逻辑可能会涉及到修改所有相关方法中的状态条件语句， 加大代码的维护难度。&#x20;</p>
<p>这个问题会随着项目进行变得越发严重。 因为我们很难在设计阶段预测到所有可能的状态和转换。 随着时间推移， 最初只包含有限条件语句的简洁状态机可能会变得非常臃肿。</p>
<h2 id="解决-6"><a href="#解决-6" class="headerlink" title="解决"></a>解决</h2><p>状态模式建议为所有可能状态都新建一个对应的类，然后把该状态的对应行为抽取到类中。</p>
<p>原始对象被称为上下文（con­text），它并不会自行实现所有行为，而是会保存一个指向当前状态对象的引用，把所有跟状态相关的工作委派给这个对象。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-22.png"></p>
<p>文档将工作委派给一个状态对象。</p>
<p>如果需要把上下文转换成另外一种状态，就需要把当前引用的状态对象替换成另外一个新状态对象。当然采用这种方式是有前提的：所有状态类都必须遵循同样的接口，而且上下文必须只通过接口与这些状态对象进行交互。</p>
<p>这个结构可能看上去跟策略模式有点像，但有一个关键性的不同——在状态模式里，特定状态知道其他所有状态的存在，能触发从一个状态到另一个状态的转换；而策略几乎完全不知道其他策略的存在。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Context 类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Document</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">DocumentState</span> currentState;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> currentUserRole;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Document</span>() &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">currentState</span> = <span class="keyword">new</span> <span class="title class_">DraftState</span>();  <span class="comment">// 初始化为草稿状态</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置当前用户角色</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setCurrentUserRole</span>(<span class="params"><span class="title class_">String</span> role</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">currentUserRole</span> = role;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 状态转移方法</span></span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">transitionTo</span>(<span class="params"><span class="title class_">DocumentState</span> state</span>) &#123;  <span class="comment">// 支持状态自我转换</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">currentState</span> = state;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 发布入口方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">publish</span>(<span class="params"></span>) &#123;</span><br><span class="line">        currentState.<span class="title function_">handlePublish</span>(<span class="variable language_">this</span>);  <span class="comment">// 委托给当前状态处理</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// State 接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">DocumentState</span> &#123;</span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">handlePublish</span>(<span class="title class_">Document</span> context);  <span class="comment">// 参数传递上下文引用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DraftState</span> <span class="keyword">implements</span> <span class="title class_">DocumentState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">handlePublish</span>(<span class="params"><span class="title class_">Document</span> doc</span>) &#123;  <span class="comment">// 草稿状态转审核</span></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;提交文档进入审核状态&quot;</span>);</span><br><span class="line">        doc.<span class="title function_">transitionTo</span>(<span class="keyword">new</span> <span class="title class_">ModerationState</span>());  <span class="comment">// 状态自我转换</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModerationState</span> <span class="keyword">implements</span> <span class="title class_">DocumentState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">handlePublish</span>(<span class="params"><span class="title class_">Document</span> doc</span>) &#123;  <span class="comment">// 根据管理员权限处理</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>.<span class="title function_">equals</span>(doc.<span class="property">currentUserRole</span>)) &#123;  <span class="comment">// 获取上下文中的角色信息</span></span><br><span class="line">            <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;管理员发布文档&quot;</span>);</span><br><span class="line">            doc.<span class="title function_">transitionTo</span>(<span class="keyword">new</span> <span class="title class_">PublishedState</span>());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;非管理员无法发布&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PublishedState</span> <span class="keyword">implements</span> <span class="title class_">DocumentState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">handlePublish</span>(<span class="params"><span class="title class_">Document</span> doc</span>) &#123;  <span class="comment">// 终态不处理</span></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;文档已发布，无法重复操作&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Client（客户端）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">main</span>(<span class="params"><span class="title class_">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="title class_">Document</span> doc = <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试普通用户场景</span></span><br><span class="line">        doc.<span class="title function_">setCurrentUserRole</span>(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        doc.<span class="title function_">publish</span>();  <span class="comment">// Draft → Moderation</span></span><br><span class="line">        doc.<span class="title function_">publish</span>();  <span class="comment">// 保持Moderation</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试管理员场景</span></span><br><span class="line">        doc.<span class="title function_">setCurrentUserRole</span>(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        doc.<span class="title function_">publish</span>();  <span class="comment">// Moderation → Published</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查终态稳定性</span></span><br><span class="line">        doc.<span class="title function_">publish</span>();  <span class="comment">// 保持Published状态</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关键优化点：</p>
<ol>
<li><p><strong>状态自管理</strong>：每个具体状态类自行控制下一步状态转换</p>
</li>
<li><p><strong>上下文访问</strong>：通过传递文档引用获取当前用户角色（简化私有字段访问）</p>
</li>
<li><p><strong>可扩展性</strong>：新增状态只需创建类并实现接口，无需修改现有代码</p>
</li>
<li><p><strong>消除条件逻辑</strong>：完全移除switch&#x2F;case结构，使用多态分发</p>
</li>
</ol>
<h2 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-16.png"></p>
<ol>
<li><p>上下文（Con­text）保存了对于一个具体状态对象的引用，会把所有跟这个状态相关的工作委派给它。上下文通过状态接口和状态对象交互，并且会提供一个设置器用于传递新的状态对象。</p>
</li>
<li><p>状态（State）接口会声明特定于状态的方法。这些方法能被其他所有具体状态所理解及调用。</p>
</li>
<li><p>具体状态（Con­crete States）会自行实现特定于状态的方法。为了避免多个状态中包含相似代码，你可以提供一个封装有部分通用行为的中间抽象类。</p>
</li>
</ol>
<p>另外，状态对象可存储对于上下文对象的反向引用。状态可以通过这个引用从上下文里获取所需信息，并且能触发状态转移。</p>
<ul>
<li>上下文和具体状态都可以设置上下文的下个状态，并可以通过替换连接到上下文的状态对象来完成实际的状态转换。</li>
</ul>
<h1 id="策略"><a href="#策略" class="headerlink" title="策略"></a>策略</h1><h2 id="简介-7"><a href="#简介-7" class="headerlink" title="简介"></a>简介</h2><p>策略是一种行为设计模式，它能让你定义一系列算法，并将每种算法分别放入独立的类中，以使算法对象能够被替换。</p>
<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>你在开发一款导航应用，类似高德。你要实现自动路线规划的功能：希望输入地址后就能在地图上看到前往目的地的最快路线。</p>
<p>程序的首个版本只能规划公路路线，只适合自驾的人。为了尽量向高德靠拢，你想添加规划步行路线的功能。之后，可能还要添加规划公交地铁路线的功能。过不久可能还要给骑行者规划路线。又过了一段时间，可能还要给城市中的所有景点提供游览路线。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-17.png"></p>
<p>导航代码将变得非常臃肿。</p>
<p>这时你发现，每次添加新的路线规划算法后，导航应用中主要类的体积就会增加一倍。代码就越来越难维护。</p>
<p>无论是修复简单缺陷还是微调街道权重，对某个算法进行任何修改都会影响整个类，从而增加了在已有正常代码中引入错误的风险。</p>
<p>另外，团队合作也非常低效。如果应用由一个团队开发，开发者会在合并冲突的工作上花费很长时间。在实现新功能的过程中，团队需要修改同一个巨大的类，很容易出现冲突。</p>
<h2 id="解决-7"><a href="#解决-7" class="headerlink" title="解决"></a>解决</h2><p>策略模式建议找出用不同方式完成特定任务的类，然后把里面的算法抽取到一组叫做策略的独立类里。</p>
<p>名叫上下文的原始类必须包含一个成员变量来存储对于每种策略的引用。上下文并不执行任务，而是把工作委派给引用的策略对象。</p>
<p>上下文不负责选择符合任务需要的算法——客户端会把所需策略传递给上下文。实际上，上下文并不了解策略细节，它会通过同样的通用接口跟所有策略交互，这个接口只需要暴露一个方法供上下文调用，具体策略会在这个方法中封装特定算法。</p>
<p>因此，上下文可以独立于具体策略。这样你就可在不修改上下文代码或其他策略的情况下添加新算法或修改已有算法了。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-30.png"></p>
<p>路线规划策略。</p>
<p>在导航应用里，每个路线规划算法都可以被抽取到 只有一个build­Route生成路线方法的 独立类里。这个方法接收起点和终点作为参数，并返回路线途径点的集合。</p>
<p>就算传递给每个路径规划类的参数一模一样，它创建的路线也可能完全不同。导航类的主要工作是在地图上渲染一系列中途点，不会在意如何选择算法。这个类中还有一个用于切换当前路径规划策略的方法，因此客户端（例如用户界面中的切换按钮）可用其他策略替换当前选择的路径规划行为。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Strategy 接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">NavigationStrategy</span> &#123;</span><br><span class="line">    <span class="title class_">List</span>&lt;<span class="title class_">String</span>&gt; <span class="title function_">buildRoute</span>(<span class="title class_">String</span> start, <span class="title class_">String</span> end);  <span class="comment">// 路由算法接口</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体策略实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WalkingStrategy</span> <span class="keyword">implements</span> <span class="title class_">NavigationStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">String</span>&gt; <span class="title function_">buildRoute</span>(<span class="params"><span class="title class_">String</span> start, <span class="title class_">String</span> end</span>) &#123;  <span class="comment">// 步行策略</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">List</span>.<span class="title function_">of</span>(start, <span class="string">&quot;→ Central Park&quot;</span>, <span class="string">&quot;→ 5th Ave&quot;</span>, end);  <span class="comment">// 步行路线</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BusTourStrategy</span> <span class="keyword">implements</span> <span class="title class_">NavigationStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">String</span>&gt; <span class="title function_">buildRoute</span>(<span class="params"><span class="title class_">String</span> start, <span class="title class_">String</span> end</span>) &#123;  <span class="comment">// 巴士路线策略</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">List</span>.<span class="title function_">of</span>(start, <span class="string">&quot;→ Bus Stop A&quot;</span>, <span class="string">&quot;→ Bus Terminal&quot;</span>, end);  <span class="comment">// 公交路线 </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelicopterStrategy</span> <span class="keyword">implements</span> <span class="title class_">NavigationStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">String</span>&gt; <span class="title function_">buildRoute</span>(<span class="params"><span class="title class_">String</span> start, <span class="title class_">String</span> end</span>) &#123;  <span class="comment">// 飞行路线策略</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">List</span>.<span class="title function_">of</span>(start, <span class="string">&quot;→ Airport&quot;</span>, <span class="string">&quot;→ &quot;</span>+end+<span class="string">&quot; Airspace&quot;</span>, end);  <span class="comment">// 空中路线 </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TourGuide</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">NavigationStrategy</span> strategy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setStrategy</span>(<span class="params"><span class="title class_">NavigationStrategy</span> strategy</span>) &#123;  <span class="comment">// 运行时切换策略 </span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">strategy</span> = strategy; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">showRoute</span>(<span class="params"><span class="title class_">String</span> start, <span class="title class_">String</span> end</span>) &#123;  <span class="comment">// 统一入口方法</span></span><br><span class="line">        <span class="keyword">if</span>(strategy == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;请先选择导览策略&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">String</span>&gt; checkpoints = strategy.<span class="title function_">buildRoute</span>(start, end);  <span class="comment">// 委托策略执行 </span></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;建议路线：&quot;</span>);</span><br><span class="line">        checkpoints.<span class="title function_">forEach</span>(point -&gt; <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;▪ &quot;</span> + point));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">main</span>(<span class="params"><span class="title class_">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="title class_">TourGuide</span> app = <span class="keyword">new</span> <span class="title class_">TourGuide</span>();</span><br><span class="line">        <span class="title class_">Scanner</span> input = <span class="keyword">new</span> <span class="title class_">Scanner</span>(<span class="title class_">System</span>.<span class="property">in</span>);</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;请选择导览模式：\n1.步行 2.巴士 3.直升机&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        int choice = input.<span class="title function_">nextInt</span>();  <span class="comment">// 动态选择策略 </span></span><br><span class="line">        <span class="keyword">switch</span>(choice) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                app.<span class="title function_">setStrategy</span>(<span class="keyword">new</span> <span class="title class_">WalkingStrategy</span>());  <span class="comment">// 绑定步行策略 </span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                app.<span class="title function_">setStrategy</span>(<span class="keyword">new</span> <span class="title class_">BusTourStrategy</span>());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                app.<span class="title function_">setStrategy</span>(<span class="keyword">new</span> <span class="title class_">HelicopterStrategy</span>());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;无效选择&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        app.<span class="title function_">showRoute</span>(<span class="string">&quot;时代广场&quot;</span>, <span class="string">&quot;自由女神像&quot;</span>);  <span class="comment">// 执行所选策略 </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关键实现细节说明：</p>
<ol>
<li><p><strong>策略切换机制</strong>：通过setStrategy方法动态绑定策略对象</p>
</li>
<li><p><strong>算法封装</strong>：每个具体策略类自行实现路径生成算法</p>
</li>
<li><p><strong>正交扩展</strong>：新增导航策略无需修改现有代码（如可添加BicycleStrategy）</p>
</li>
<li><p><strong>接口统一</strong>：所有策略实现相同的buildRoute方法签名</p>
</li>
</ol>
<h2 id="总结-7"><a href="#总结-7" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-31.png"></p>
<ol>
<li><p>上下文（Con­text）维护指向具体策略的引用，且只通过策略接口与策略对象进行交流。</p>
</li>
<li><p>策略（Strat­e­gy）接口是所有具体策略的通用接口，它声明了一个上下文用于执行策略的方法。</p>
</li>
<li><p>具体策略（Con­crete Strate­gies）实现了上下文所用算法的各种不同变体。</p>
</li>
<li><p>当上下文需要运行算法时，它会调用策略对象的方法。上下文不清楚它所涉及的策略类型与算法的执行方式。</p>
</li>
<li><p>客户端（Client）会创建一个特定策略对象并把他传递给上下文。上下文会提供一个设置器以便客户端在运行时替换相关联的策略。</p>
</li>
</ol>
<h1 id="模板方法"><a href="#模板方法" class="headerlink" title="模板方法"></a>模板方法</h1><h2 id="简介-8"><a href="#简介-8" class="headerlink" title="简介"></a>简介</h2><p>模板方法是一种行为设计模式，它在超类中定义了一个算法的框架，允许子类在不修改结构的情况下重写算法的特定步骤。</p>
<h2 id="场景-1"><a href="#场景-1" class="headerlink" title="场景"></a>场景</h2><p>假如你正在开发一款分析文档的数据挖掘程序。用户需要向程序输入各种格式（PDF、DOC 或 CSV）的文档，程序会试图从这些文件中提取有意义的数据，再以统一的格式返回给用户。</p>
<p>程序的首个版本只支持 DOC 文件。下一个版本，程序需要支持 CSV 文件。一个月后，程序又需要从 PDF 文件中抽取数据。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-32.png"></p>
<p>数据挖掘类中包含许多重复代码。</p>
<p>一段时间后，你发现这三个类中包含许多相似代码。尽管读取不同格式数据的代码完全不同，但数据处理和分析的代码却几乎完全一样。怎么在保持算法结构完整的情况下去除重复代码？这是第一个问题。</p>
<p>还有另一个与使用这些类的客户端代码相关的问题：客户端代码中包含许多条件语句，因为它要根据不同的文档类型选择合适的处理过程。 如果所有处理数据的类都有相同的接口或基类，那你就可以去除客户端代码里的条件语句，转而使用多态机制来调用处理对象的方法。</p>
<h2 id="解决-8"><a href="#解决-8" class="headerlink" title="解决"></a>解决</h2><p>模板方法模式建议把算法分解为一系列步骤，然后将这些步骤改写为方法，最后在“模板方法”中依次调用这些方法。步骤可以是抽象的，也可以有一些默认的实现。为了能够使用算法，客户端需要自己提供子类，并且实现所有的抽象步骤。可能还需重写一些步骤（但这一步中不包括模板方法自身）。</p>
<p>让我们想想怎么在数据挖掘程序里运用这样的方案。我们可为三个解析算法创建一个基类，这个类定义了一个模板方法-mine方法，这个方法会在内部调用不同的文档处理步骤。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-33.png"></p>
<p>模板方法将算法分解为步骤，并允许子类重写这些步骤，而非重写实际的模板方法。</p>
<p>首先，我们将所有步骤声明为抽象类型，强制要求子类自行实现这些方法。在我们的例子里，子类已经实现了必须的方法，因此我们只需调整这些方法的名称，让他跟超类的方法匹配就行了。</p>
<p>现在，让我们看看怎么去除子类里的重复代码。对于不同的文件格式，打开和关闭文件以及读取解析数据的代码都不同，所以不需要修改这些方法。但分析原始数据和生成报告等其他步骤的实现方式非常相似，所以可以把他们提取到基类里，让子类共享这些代码。</p>
<p>所以我们有两种类型的步骤：</p>
<ol>
<li><p>抽象步骤必须由各个子类来实现</p>
</li>
<li><p>可选步骤已经有一些默认实现，但你仍然可以在需要时进行重写</p>
</li>
</ol>
<p>还有另一种名为钩子 hook 的步骤。钩子是内容为空的可选的步骤。即使子类不重写钩子，模板方法也能工作。钩子通常放置在算法重要步骤的前后，为子类提供额外的算法扩展点。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象类定义模板方法</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">DataMiner</span> &#123;</span><br><span class="line">    <span class="comment">// 模板方法（不可被覆盖）</span></span><br><span class="line">    <span class="keyword">public</span> final <span class="built_in">void</span> <span class="title function_">processDocument</span>(<span class="params"></span>) &#123;  </span><br><span class="line">        <span class="title function_">openDocument</span>();</span><br><span class="line">        <span class="title function_">extractRawData</span>();</span><br><span class="line">        <span class="title function_">parseData</span>();           <span class="comment">// 抽象步骤</span></span><br><span class="line">        <span class="title function_">analyzeData</span>();         <span class="comment">// 通用实现</span></span><br><span class="line">        <span class="title function_">generateReport</span>();      <span class="comment">// Hook方法</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 文档打开基础实现</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">void</span> <span class="title function_">openDocument</span>(<span class="params"></span>) &#123;  </span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;打开文档...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 数据抽取基础实现</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">void</span> <span class="title function_">extractRawData</span>(<span class="params"></span>) &#123;  </span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;抽取原始数据...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 解析算法必须子类实现</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="built_in">void</span> <span class="title function_">parseData</span>();  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通用分析实现</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">void</span> <span class="title function_">analyzeData</span>(<span class="params"></span>) &#123;  </span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;执行数据聚类分析...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 钩子方法（可选覆盖） */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">void</span> <span class="title function_">generateReport</span>(<span class="params"></span>) &#123;  </span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;生成基础统计报表&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体子类实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PDFDataMiner</span> <span class="keyword">extends</span> <span class="title class_ inherited__">DataMiner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">void</span> <span class="title function_">parseData</span>(<span class="params"></span>) &#123;  <span class="comment">// 实现特定解析逻辑</span></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;解析PDF版式结构&quot;</span>);</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;提取PDF文本流&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CSVDataMiner</span> <span class="keyword">extends</span> <span class="title class_ inherited__">DataMiner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">void</span> <span class="title function_">parseData</span>(<span class="params"></span>) &#123;  </span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;识别CSV分隔符&quot;</span>);</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;映射CSV字段&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">void</span> <span class="title function_">generateReport</span>(<span class="params"></span>) &#123;  <span class="comment">// 自定义Hook实现</span></span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">generateReport</span>();</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;追加CSV格式验证结果&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端调用示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="title function_">main</span>(<span class="params"><span class="title class_">String</span>[] args</span>) &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;处理PDF文档：&quot;</span>);</span><br><span class="line">        <span class="title class_">DataMiner</span> pdfProcessor = <span class="keyword">new</span> <span class="title class_">PDFDataMiner</span>();</span><br><span class="line">        pdfProcessor.<span class="title function_">processDocument</span>();  <span class="comment">// 执行完整流程</span></span><br><span class="line"></span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;\n处理CSV文档：&quot;</span>);</span><br><span class="line">        <span class="title class_">DataMiner</span> csvProcessor = <span class="keyword">new</span> <span class="title class_">CSVDataMiner</span>();</span><br><span class="line">        csvProcessor.<span class="title function_">processDocument</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关键优化点说明</p>
<ol>
<li><p><strong>固定流程</strong>：不可重写的processDocument()确保流程一致</p>
</li>
<li><p><strong>职责分离</strong>：各子类仅需实现格式相关解析逻辑</p>
</li>
<li><p><strong>扩展能力</strong>：通过钩子方法实现可选扩展（如CSV格式验证）</p>
</li>
</ol>
<h2 id="总结-8"><a href="#总结-8" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-34.png"></p>
<ol>
<li><p>抽象类（Abstract­Class）会声明算法步骤的方法（step1，step2…），以及依次调用它们的模板方法(templateMethod)。算法步骤可以被声明为抽象类型，也可以提供一些默认实现。</p>
</li>
<li><p>具体类（Con­crete­Class）可以重写所有步骤，但不能重写模板方法自身。</p>
</li>
</ol>
<h1 id="访问者"><a href="#访问者" class="headerlink" title="访问者"></a>访问者</h1><h2 id="简介-9"><a href="#简介-9" class="headerlink" title="简介"></a>简介</h2><p>访问者是一种行为设计模式，它能把算法跟他所作用的对象隔离开来。</p>
<h2 id="场景-2"><a href="#场景-2" class="headerlink" title="场景"></a>场景</h2><p>假如你的团队开发了一款能够使用图像里地理信息的应用程序。图像中的每个节点既能代表复杂实体（例如一座城市），也能代表更精细的对象（例如工业区和旅游景点等）。每个节点的类型都由它所属的类来表示，每个特定的节点就是一个对象。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-35.png"></p>
<p>将图像导出为  XML。</p>
<p>现在，你需要把图像导出到 XML 文件里。你打算为每个节点类添加导出函数，然后递归执行图像中每个节点的导出函数，有点类似我们之前的组合模式。另外，还可以使用多态让导出方法的调用代码不和具体的节点类相耦合。</p>
<p>但其他同事并不想修改已有的节点类。他们认为这些代码已经是产品了，修改的话可能会引入缺陷。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-36.png"></p>
<p>所有节点的类里都必须添加导出至 XML 文件的方法，但如果在修改代码的过程中引入了任何缺陷，那么整个程序都会面临风险。</p>
<p>另外，他们觉得在节点类里包含导出 XML 文件的代码好像没有意义。这些类的主要工作是处理地理数据。加入导出 XML 文件的代码明显不合适。</p>
<p>还有，这个功能完成之后，很有可能还需要提供导出其他类型文件的功能，或者其他奇怪的功能。这样你很可能要再次修改这些脆弱的类。</p>
<h2 id="解决-9"><a href="#解决-9" class="headerlink" title="解决"></a>解决</h2><p>访问者模式建议把新功能（行为）放在一个叫做访问者的独立类里，而不是整合到已有类里。需要执行操作的原始对象将作为参数传给访问者的方法，让方法能访问对象所包含的一切必要数据。</p>
<p>对于不同类的对象（比如示例里不同的节点），该怎么操作？ 在我们的示例里，不同节点类导出 XML 文件的实际实现很可能不同。因此，访问者类可以定义一组方法，每个方法可接收特定类型的参数，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExportVisitor</span> <span class="keyword">implements</span> <span class="title class_">Visitor</span> ｛</span><br><span class="line">    method <span class="title function_">doForCity</span><span class="params">(City c)</span> &#123; ... &#125;</span><br><span class="line">    method <span class="title function_">doForIndustry</span><span class="params">(Industry f)</span> &#123; ... &#125;</span><br><span class="line">    method <span class="title function_">doForSightSeeing</span><span class="params">(SightSeeing ss)</span> &#123; ... &#125;</span><br><span class="line">｝</span><br></pre></td></tr></table></figure>

<p>但我们究竟应该怎么调用这些方法（尤其是在处理整个图像方面）呢？这些方法的签名各不相同，我们就不能用多态机制。为了可以挑选出能够处理特定对象的访问者方法，我们需要先对它的类进行检查。是不是很麻烦？</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">foreach</span> (<span class="title class_">Node</span> node <span class="keyword">in</span> graph) ｛</span><br><span class="line">    <span class="keyword">if</span> (node <span class="keyword">instanceof</span> <span class="title class_">City</span>)</span><br><span class="line"> exportVisitor.<span class="title function_">doForCity</span>((<span class="title class_">City</span>) node)</span><br><span class="line">    <span class="keyword">if</span> (node <span class="keyword">instanceof</span> <span class="title class_">Industry</span>)</span><br><span class="line">        exportVisitor.<span class="title function_">doForIndustry</span>((<span class="title class_">Industry</span>) node)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们为什么不用方法重载？即使用相同的方法名称，但它们的参数不同。 我们无法提前知道节点对象所属的类，所以重载机制没办法执行正确的方法。因为方法会把节点基类作为输入参数的默认类型。</p>
<p>访问者模式可以解决这个问题。它使用了一种叫做双分派的技巧，不使用麻烦的条件语句也可以执行正确的方法。其实，与其让客户端来选择调用特定的方法，不如把选择权委派给 作为参数传递给访问者的对象。因为这个对象知道它自己的类，能更自然地在访问者中选出正确的方法。它们会“接收”一个访问者并且告诉它应该执行的访问者方法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Client code</span></span><br><span class="line"><span class="title function_">foreach</span> (<span class="title class_">Node</span> node <span class="keyword">in</span> graph)</span><br><span class="line">    node.<span class="title function_">accept</span>(exportVisitor)</span><br><span class="line"><span class="comment">// City</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">City</span> is</span><br><span class="line">    method <span class="title function_">accept</span>(<span class="title class_">Visitor</span> v) is</span><br><span class="line">        v.<span class="title function_">doForCity</span>(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="comment">// Industry</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Industry</span> is</span><br><span class="line">    method <span class="title function_">accept</span>(<span class="title class_">Visitor</span> v) is</span><br><span class="line">        v.<span class="title function_">doForIndustry</span>(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>我们还是修改了节点类，但改动很小，而且我们能在后续添加行为时 不需要再次修改节点类的代码。</p>
<p>现在，如果我们抽取出所有访问者的通用接口，所有已有的节点都能跟任何访问者交互了。如果需要引入跟节点相关的某个行为，你只需要实现一个新的访问者类就行了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Visitor 接口定义地理信息操作规范</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">GeoVisitor</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visitCity</span><span class="params">(CityElement city)</span>;     <span class="comment">// 城市节点访问接口 </span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visitIndustry</span><span class="params">(IndustryElement industry)</span>; <span class="comment">// 工业区访问接口</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visitSightseeing</span><span class="params">(SightseeingElement sight)</span>; <span class="comment">// 景区访问接口</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具象访问者（统计信息导出）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StatisticsExporter</span> <span class="keyword">implements</span> <span class="title class_">GeoVisitor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitCity</span><span class="params">(CityElement city)</span> &#123;  <span class="comment">// 处理城市数据</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;统计城市[%s]: 人口%d万 | &quot;</span>,</span><br><span class="line">            city.getName(), city.getPopulation());  <span class="comment">// 访问节点属性</span></span><br><span class="line">        System.out.println(<span class="string">&quot;GDP &quot;</span> + city.getGDP() + <span class="string">&quot;亿元&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitIndustry</span><span class="params">(IndustryElement industry)</span> &#123;  <span class="comment">// 处理工业区</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;工业区评估: %s 类型 | 占地面积%.1f平方公里\n&quot;</span>,</span><br><span class="line">            industry.getIndustryType(), industry.getArea());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitSightseeing</span><span class="params">(SightseeingElement sight)</span> &#123;  <span class="comment">// 处理景点</span></span><br><span class="line">        System.out.printf(<span class="string">&quot;景点分级: %s（%dA景区）\n&quot;</span>,</span><br><span class="line">            sight.getLandmark(), sight.getRating());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 地理元素抽象接口（使用双分派机制）</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">GeoElement</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(GeoVisitor visitor)</span>;  <span class="comment">// 关键接收方法 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 城市实体类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CityElement</span> <span class="keyword">implements</span> <span class="title class_">GeoElement</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> population;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> gdp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CityElement</span><span class="params">(String name, <span class="type">int</span> pop, <span class="type">double</span> gdp)</span> &#123; ... &#125; </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(GeoVisitor visitor)</span> &#123;  <span class="comment">// 双分派入口 </span></span><br><span class="line">        visitor.visitCity(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getters省略</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工业园区实体类 </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IndustryElement</span> <span class="keyword">implements</span> <span class="title class_">GeoElement</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String industryType;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> area;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">IndustryElement</span><span class="params">(String type, <span class="type">double</span> area)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(GeoVisitor visitor)</span> &#123;</span><br><span class="line">        visitor.visitIndustry(<span class="built_in">this</span>);  <span class="comment">// 调用工业区专门方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 旅游景区实体类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SightseeingElement</span> <span class="keyword">implements</span> <span class="title class_">GeoElement</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String landmark;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> rating;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SightseeingElement</span><span class="params">(String name, <span class="type">int</span> stars)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(GeoVisitor visitor)</span> &#123;</span><br><span class="line">        visitor.visitSightseeing(<span class="built_in">this</span>); <span class="comment">// 调用景区处理逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GeoClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 构建地理数据模型（复杂对象结构）</span></span><br><span class="line">        List&lt;GeoElement&gt; geoGraph = Arrays.asList(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">CityElement</span>(<span class="string">&quot;上海&quot;</span>, <span class="number">2487</span>, <span class="number">43214</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">IndustryElement</span>(<span class="string">&quot;化工&quot;</span>, <span class="number">58.3</span>),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">SightseeingElement</span>(<span class="string">&quot;外滩&quot;</span>, <span class="number">5</span>)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 应用统计访问者</span></span><br><span class="line">        <span class="type">GeoVisitor</span> <span class="variable">exporter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StatisticsExporter</span>();</span><br><span class="line">        geoGraph.forEach(element -&gt; element.accept(exporter));  <span class="comment">// 统一访问入口 </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>核心实现</p>
<ol>
<li><p><strong>双分派机制</strong>：通过element.accept()调用visitor特定方法</p>
</li>
<li><p><strong>开放扩展</strong>：新增数据操作只需添加访问者类</p>
</li>
<li><p><strong>数据结构稳定</strong>：元素类无需修改即可支持新业务逻辑</p>
</li>
</ol>
<h2 id="总结-9"><a href="#总结-9" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/image-37.png"></p>
<ol>
<li><p>访问者（Vis­i­tor）接口：声明了一系列以Concrete Element为参数的访问者方法。如果编程语言支持重载，这些方法的名称可以是相同的，但是他们的参数一定是不同的。</p>
</li>
<li><p>具体访问者（Con­crete Vis­i­tor）会为不同的Concrete Element实现相同行为的几个不同版本。</p>
</li>
<li><p>元素（Ele­ment）接口声明了一个方法来“接收”访问者。这个方法必须有一个参数被声明为访问者接口类型。</p>
</li>
<li><p>具体元素（Con­crete Ele­ment）必须实现接收方法。这个方法的目的是根据当前元素类把调用重定向到相应访问者的方法里。请注意，即使元素基类实现了这个方法，所有子类都必须对它进行重写并调用访问者对象中的合适方法。</p>
</li>
<li><p>客户端（Client）通常会作为集合或其他复杂对象（例如一个组合树）的代表。客户端通常不知道所有的具体元素类，因为它们会通过抽象接口与集合中的对象进行交互。</p>
</li>
</ol>
<h1 id="解释器"><a href="#解释器" class="headerlink" title="解释器"></a>解释器</h1><h2 id="简介-10"><a href="#简介-10" class="headerlink" title="简介"></a>简介</h2><p>解释器设计模式提供了一种解释和评估语言中的句子或表达式的方法。因为场景比较单一，所以放在最后来讲。此模式定义了一种语言语法，以及一个可以解析和执行表达式的解释器。</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p>它通过定义语法和解释器来提供解释和评估语言表达式的机制。该模式将语言元素表示为类，并使用递归算法来评估表达式。它提高了可扩展性并允许添加新的语法规则或语言结构。</p>
<p><img src="/2024/03/08/architecture/design_pattern/design_pattern3/diagram.png"></p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><ol>
<li><p><strong>抽象表达式</strong>：抽象表达式类为语言表达式定义了一个抽象接口。它声明了一个<code>interpret()</code>，这个方法定义了表达式的解释逻辑。</p>
</li>
<li><p>TerminalExpression <strong>终结符表达式：</strong>&#x7EC8;端表达式类代表了语言的基本构建块。它们实现抽象表达式接口并为终端表达式提供解释逻辑。</p>
</li>
<li><p>NonterminalExpression <strong>非终结符表达式：</strong>&#x975E;终结符表达式类表示由多个子表达式组成的复合表达式。它们还实现抽象表达式接口并为复合表达式提供解释逻辑。</p>
</li>
<li><p><strong>上下文：</strong>&#x4E0A;下文类提供解释表达式所需的任何必要信息或状态。它维护解释过程中表达式之间共享的全局信息。</p>
</li>
</ol>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>让我们使用 Java 代码演示解释器设计模式的实现。我们将创建一个简单的算术表达式解释器的示例，它可以评估和计算算术表达式的结果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Abstract Expression</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Terminal Expressions</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NumberExpression</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> number;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NumberExpression</span><span class="params">(<span class="type">int</span> number)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.number = number;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> number;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AddExpression</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Expression leftExpression;</span><br><span class="line">    <span class="keyword">private</span> Expression rightExpression;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AddExpression</span><span class="params">(Expression leftExpression, Expression rightExpression)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.leftExpression = leftExpression;</span><br><span class="line">        <span class="built_in">this</span>.rightExpression = rightExpression;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> leftExpression.interpret(context) + rightExpression.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Context</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    <span class="comment">// Additional context information, if needed</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Client</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// Create the expression: (2 + 3) + 4</span></span><br><span class="line">        <span class="type">Expression</span> <span class="variable">expression</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AddExpression</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AddExpression</span>(<span class="keyword">new</span> <span class="title class_">NumberExpression</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">NumberExpression</span>(<span class="number">3</span>)),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">NumberExpression</span>(<span class="number">4</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// Create the context, if needed</span></span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">        <span class="comment">// Interpret the expression</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> expression.interpret(context);</span><br><span class="line">        System.out.println(<span class="string">&quot;Result: &quot;</span> + result); <span class="comment">// Output: Result: 9</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>接口<code>Expression</code>定义抽象表达式。它声明了<code>interpret()</code>方法，为表达式提供解释逻辑。</em></p>
<p><em><code>NumberExpression</code>表示终结表达式。它实现<code>Expression</code>接口并提供数值的解释逻辑。</em></p>
<p><em><code>AddExpression</code>表示非终结表达式。它实现<code>Expression</code>接口并提供加法表达式的解释逻辑。</em></p>
<p><em>类<code>Context</code>代表上下文，它提供解释表达式所需的任何必要信息或状态。</em></p>
<p><em><code>Application</code>充当客户端代码。它创建一个表示算术表达式的表达式<code>(2 + 3) + 4</code>，创建一个上下文（如果需要），然后解释该表达式以计算结果。</em></p>
<p><strong>使用解释器：</strong>&#x8981;在算术表达式解释器示例中使用解释器模式，客户端可以创建终结和非终结表达式的实例，并使用它们来构建复杂表达式。然后，他们可以通过调用<code>interpret()</code>顶级表达式上的方法来解释表达式。</p>
<p>在提供的示例中，我们创建了一个表示算术表达式的表达式<code>(2 + 3) + 4</code>。我们创建一个上下文（尽管在这个简单的示例中不需要），然后调用<code>interpret()</code>表达式上的方法来计算结果，并将其打印到控制台。</p>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ol>
<li><p><strong>可扩展性</strong>：解释器模式允许通过创建新的表达式类来添加新的语法规则或语言结构。这使得它灵活且可扩展，以适应新的语言特性。</p>
</li>
<li><p><strong>关注点分离：</strong>&#x8BE5;模式将解释逻辑与语言表达式分离。每个表达式类专注于解释其特定的语法规则，从而提高代码的模块化和可维护性。</p>
</li>
<li><p><strong>简化的语法表示：</strong>&#x89E3;释器模式使用面向对象的类和递归算法提供了一种清晰简洁的方式来表示复杂的语法。</p>
</li>
<li><p><strong>易于实现新的解释器：</strong>&#x8BE5;模式提供了一种为不同语言或领域特定语言（DSL）创建解释器的结构化方法。</p>
</li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpg" alt="GalaxyGuan WeChat Pay">
        <span>WeChat Pay</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>GalaxyGuan
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/" title="设计模式之行为型模式">https://galaxyguan12.github.io/2024/03/08/architecture/design_pattern/design_pattern3/</a>
  </li>
  <li class="post-copyright-license">
      <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag"># 设计模式</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/02/08/architecture/design_pattern/design_pattern2/" rel="prev" title="设计模式之结构型模式">
                  <i class="fa fa-angle-left"></i> 设计模式之结构型模式
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/06/27/ml/nn/backpropagation1/" rel="next" title="深入浅出反向传播（1）">
                  深入浅出反向传播（1） <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">GalaxyGuan</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
